<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[è®°ä¸€æ¬¡React Nativeè¿œç¨‹è°ƒè¯•ï¼Œè§£å†³åªåœ¨åƒé‡Œä¹‹å¤–å¯é‡çŽ°çš„Bugã€‚]]></title>
    <url>%2F2017%2F08%2F06%2Freact-native-remote-debug%2F</url>
    <content type="text"><![CDATA[å‰è¨€è¿™ç¯‡æ–‡ç« çš„ä¸»è¦å†…å®¹æœ‰ä¸¤ä¸ªï¼š React Nativeå¦‚ä½•è°ƒè¯•ä¸åœ¨å±€åŸŸç½‘å†…çš„è®¾å¤‡ã€å¦‚ä½•æŠŠè¿™äº›è®¾å¤‡å˜æˆåœ¨å±€åŸŸç½‘å†…æ–¹ä¾¿åœ°è°ƒè¯•ï¼ˆæ— è®ºè®¾å¤‡åœ¨4Gè¿˜æ˜¯Wifiçš„æƒ…å†µä¸‹ï¼‰ æ·±å‘æé†’ï¼šæˆªæ­¢åˆ°å‘ç¨¿å‰åŽä¸ºP10æœ€æ–°ç‰ˆæœ¬ç³»ç»Ÿ EMUI5.0 (Android 7.0ï¼‰ï¼ŒStyle Sheetä¸­çš„transformå±žæ€§å¤±æ•ˆäº† æ•…äº‹çš„èµ·å› ä¸€å¤©ï¼Œè€å¸ˆè¿‡æ¥è·Ÿæˆ‘è¯´ï¼Œå’±ä»¬AppèŠå¤©æ¨¡å—é‡Œé¢çš„åˆ—è¡¨ï¼Œåœ¨ä¸€å°åŽä¸ºP10æ‰‹æœºä¸Šé¢æ˜¾ç¤ºä¸å‡ºæ¥ï¼Œå®ƒèƒ½å‘æ¶ˆæ¯ï¼Œåˆ«äººä¹Ÿèƒ½çœ‹åˆ°å®ƒå‘çš„æ¶ˆæ¯ï¼Œä½†æ˜¯å®ƒå´è¿žè‡ªå·±å‘çš„æ¶ˆæ¯ä¹Ÿçœ‹ä¸åˆ°ï¼Œæ˜¯ä¸ªå¿…çŽ°çš„é—®é¢˜ï¼Œè®©æˆ‘æŸ¥æŸ¥è¿™æ˜¯ä»€ä¹ˆå¹ºè›¾å­ã€‚ å—¯ï¼Œè¿™å°æ‰‹æœºä¸åœ¨æˆ‘ä»¬è¿™ï¼Œåœ¨åˆ†å…¬å¸åŒäº‹æ‰‹é‡Œï¼Œæžä¸å®šå°±è‡ªå·±åŽ»å‡ºå·®å§ã€‚ðŸ˜€ åˆ†æžé—®é¢˜é¦–å…ˆæƒ³åˆ°ï¼šæœåŠ¡ç«¯çš„é”…ç”±äºŽæˆ‘ä»¬èŠå¤©åˆ—è¡¨çš„æ•°æ®ï¼Œå®¢æˆ·ç«¯æ˜¯ä¸ä¿å­˜çš„ï¼Œè¿™ä»½æ•°æ®ç”±æœåŠ¡ç«¯ç»´æŠ¤ï¼Œå®¢æˆ·ç«¯è®¢é˜…ä¸ŠåŽï¼ŒæœåŠ¡ç«¯ä¼šç»™å®¢æˆ·ç«¯è¿”å›žæŒ‡å®šæ•°æ®ï¼ŒäºŽæ˜¯è®©æœåŠ¡ç«¯çš„å“¥ä»¬å¸®å¿™è°ƒè¯•ï¼Œç»è¿‡ä¸€è½®ç´§å¼ å¿™ç¢Œçš„è°ƒè¯•ï¼Œæœ€åŽä»–å‘Šè¯‰æˆ‘ï¼šâ€œæˆ‘ä¸çŸ¥é“ï¼Œæˆ‘è¿™é‡Œæ˜¯å¥½çš„â€ã€‚ï¼ˆè€æ¿ï¼Œè¿™åªæ˜¯ä¸ªæ¢—ï¼Œå’±ä»¬å›¢é˜Ÿéƒ½æ˜¯è´Ÿè´£åˆ°åº•çš„å“ˆå“ˆå“ˆï¼‰ æ—¢ç„¶å¦‚æ­¤ï¼Œä¸ºäº†è¯æ˜ŽæœåŠ¡ç«¯å“¥ä»¬è¿™è½®è°ƒè¯•çš„ç»“è®ºæ˜¯å¯¹çš„ï¼Œæˆ‘æƒ³æˆ‘æœ€å¥½èƒ½çœ‹è¿™å°è¿œç¨‹æ‰‹æœºä¸Šé¢çš„Logä¿¡æ¯ï¼Œç”šè‡³æ‰“æ–­ç‚¹åŽ»debugï¼Œçœ‹çœ‹å®¢æˆ·ç«¯å‡ºäº†ä»€ä¹ˆé—®é¢˜ã€‚ æå‡ºè®¾æƒ³ç”±äºŽReact Nativeæœ¬èº«å°±æ”¯æŒDebug JS Remotelyï¼Œæ‰€ä»¥é¦–å…ˆæƒ³åˆ°çš„ï¼Œè‚¯å®šæ˜¯æŠŠæˆ‘çš„æœºå™¨é…ç½®åˆ°å¤–ç½‘ï¼Œç„¶åŽè®©åˆ†å…¬å¸çš„åŒäº‹è¿žæŽ¥åˆ°æˆ‘æœºå™¨ä¸Šå°±èƒ½è¿›è¡Œè°ƒè¯•ï¼›å…¶æœ¬åœ°çš„npmæœåŠ¡å°†ä¼šåŠ è½½node_modulesï¼Œç„¶åŽæä¾›8081ç«¯å£ç»™debugåŒ…çš„appè¿›è¡Œè¯·æ±‚ï¼Œæœ€ç»ˆåšåˆ°äº†åŠ¨æ€æŠŠjsä»£ç ä¼ è¾“åˆ°debugåŒ…çš„ç¨‹åºä¸Šã€‚ Just do it.æœ‰äº†è¿™ä¸ªæƒ³æ³•ä¹‹åŽï¼Œå°±åŽ»æ‰¾è¿ç»´åŒå­¦ï¼Œä¸€æ³¢æ“ä½œè¿‡åŽï¼Œæˆ‘çš„ç”µè„‘å·²ç»å¯ä»¥åœ¨å…¬ç½‘ä¸Šè¿›è¡Œè®¿é—®äº†ï¼ŒäºŒè¯ä¸è¯´ï¼Œå°±æ˜¯å¹²ï¼š æå–debug apk: å½“å‰é¡¹ç›®ä¸‹ï¼Œæ‰¾åˆ° â€œandroid/app/build/outputs/apk/app-debug.apkâ€ï¼Œå¦‚æžœä¿®æ”¹è¿‡é¡¹ç›®æ¨¡å—åç§°ï¼Œè‡ªå·±åŽ»æ‰¾å›žå¯¹åº”çš„è·¯å¾„ï¼Œç›¸ä¿¡è¿™ä¸ªä¸ä¼šæœ‰éš¾åº¦ï¼›åœ¨React Nativeé¡¹ç›®ä¸­ï¼Œè¿™ä¸ªdebugåŒ…è·ŸreleaseåŒ…æœ€å¤§çš„åŒºåˆ«æ˜¯ï¼šreleaseåŒ…å·²ç»æ‰“åŒ…å¥½äº†æ‰€æœ‰.jsæ–‡ä»¶åˆ°assetsç›®å½•ä¸­ï¼Œè€ŒdebugåŒ…æ˜¯é€šè¿‡è¯·æ±‚åŠ è½½æœ¬é¡¹ç›®jsä»£ç çš„npmæœåŠ¡æ¥åŠ¨æ€åŠ è½½jsæ–‡ä»¶ï¼› å®‰è£…debugåŒ…ï¼Œè¿è¡Œdebugç¨‹åºåŽï¼Œåœ¨ â€œDev Settingsâ€ ä¸­è®¾ç½® â€œDebug server host &amp; port for deviceâ€ ï¼Œåœ°å€ä¿®æ”¹ä¸ºè‡ªå·±ç”µè„‘çš„å…¬ç½‘ipï¼Œç«¯å£8081ï¼› åœ¨è°ƒè¯•èœå•ä¸­ï¼Œé€‰æ‹© â€œDebug JS Remotelyâ€ã€‚ æŽ¥ä¸‹æ¥å½“ç„¶å°±æ˜¯æœ€æ¿€åŠ¨äººå¿ƒçš„æ—¶åˆ»å•¦ï¼ŒåŒäº‹çš„æœºå™¨é¡ºåˆ©åœ°è¿žä¸Šäº†æˆ‘ç”µè„‘æœ¬åœ°çš„npmæœåŠ¡ï¼Œæˆ‘å’Œè¿ç»´å°å“¥å››ç›®ç›¸è§†ï¼Œä¼šå¿ƒä¸€ç¬‘ã€‚ç„¶è€Œï¼Œäº‹æƒ…æ€»æ˜¯å‡ºä¹Žæ„æ–™ï¼Œå‘½è¿ä¹Ÿå–œæ¬¢æ‰å¼„äººï¼Œä¸€ä¸‹ç§’ï¼Œå¦¹å­åŒäº‹è¯´æ‰‹æœºçº¢å±äº†ï¼Œåœ¨æˆ‘çš„Chromeè°ƒè¯•é¡µé¢ä¸­æ‰“å°äº†ä¸€è¡Œï¼š 123Failed to execute 'send' on 'XMLHttpRequest': Failed to load 'http://localhost:8082/create_session' Realm failed to connect to the embedded debug server inside the app. If attempting to use Chrome debugging from a device, ensure the device is reachable on the same network as this machine. æƒŠä¸æƒŠå–œï¼Œæ„ä¸æ„å¤–ï¼Ÿ å’‹ä¸€çœ‹ï¼Œä¼¼ä¹Žé—®é¢˜ä¸å¤§ï¼Œå†æŠŠæˆ‘æœºå™¨çš„8082ç«¯å£æ‰“å¼€ï¼Œæ˜¯ä¸æ˜¯åº”è¯¥å°±å¯ä»¥äº†ï¼Ÿç„¶è€Œï¼Œäº‹æƒ…æ€»æ˜¯å‡ºä¹Žæ„æ–™ï¼Œå‘½è¿ä¹Ÿå–œæ¬¢æ‰å¼„äººã€‚Xå¦¹å­è¯´ï¼Œè¿˜æ˜¯ä¸€æ ·è€¶ã€‚ç„¶åŽï¼Œæˆ‘åœ¨realm-jsçš„é¡¹ç›®ä¸‹æ‰¾åˆ°äº†è¿™ä¸ªissues: https://github.com/realm/realm-js/issues/284ï¼Œè¿™ä¸ªissueså·²ç»æ˜¯closedçŠ¶æ€ï¼Œä½†æ˜¯å¯èƒ½å› ä¸ºæˆ‘åœ¨éžå±€åŸŸç½‘è°ƒè¯•çš„åŽŸå› ï¼Œå‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬çš„realm-jsï¼Œä»ç„¶å­˜åœ¨ã€‚æ­¤æ—¶ï¼Œé»˜é»˜è¯´äº†ä¸€å¥WTFä¹‹åŽï¼Œæˆ‘æ„Ÿè§‰æ•´ä¸ªäººåž®æŽ‰äº†ã€‚ WTFä¹‹åŽçš„æ€è€ƒæ³¨æ„åˆ°é”™è¯¯æç¤ºä¸­çš„ â€œensure the device is reachable on the same network as this machineâ€ ï¼Œæˆ‘åˆæœ‰äº†ä¸€ä¸ªå¤§èƒ†çš„æƒ³æ³•ï¼šè®©è¯¥åŒäº‹çš„æ‰‹æœºï¼Œè·Ÿæˆ‘çš„ç”µè„‘åœ¨åŒä¸€ä¸ªç½‘æ®µã€‚ è¿™â€¦ä¼¼ä¹Žè¿˜çœŸæœ‰è¿™ä¹ˆä¸€ç§æ“ä½œï¼Œè¿™ä¸ªä¸–ç•Œä¸Šï¼Œæœ‰ä¸€ç§å« â€œVirtual Private Networkâ€ çš„ä¸œè¥¿ï¼ˆå’Œè°å’Œè°ï¼‰ï¼Œå‡è®¾æˆ‘çš„ç”µè„‘å’Œè¯¥åŒäº‹çš„æ‰‹æœºï¼ŒåŒæ—¶è¿žæŽ¥ä¸Šæˆ‘ä»¬è‡ªå·±çš„ä»£ç†æœåŠ¡å™¨ï¼Œé€šè¿‡è¿™ä¸ªä»£ç†çš„åœ°å€ï¼Œä¼¼ä¹Žå°±å¯ä»¥å®žçŽ° â€œåœ¨åŒä¸€ä¸ªç½‘æ®µâ€ è¿™ä¸ªéœ€æ±‚ã€‚ ç”µè„‘è¿žæŽ¥ä¸Šä»£ç†åŽï¼Œä¼šå†åˆ†é…ä¸€ä¸ªåœ°å€ï¼ŒMacä¸Šä½¿ç”¨ifconfigå‘½ä»¤æŸ¥çœ‹ (Win ipconfig)ï¼šä¸‹é¢è¿™ä¸€æ³¢æ“ä½œå°±å¾ˆç¨³äº†ï¼Œæˆ‘ä»¬ç»ˆäºŽé¡ºåˆ©è¿žæŽ¥åˆ°äº†XåŒæ—¶çš„æ‰‹æœºï¼Œå¯ä»¥çœ‹åˆ°Logï¼Œä¹Ÿçœ‹åˆ°æ‰“æ–­ç‚¹ï¼Œç”šè‡³åœ¨4Gä¸‹éƒ½å¯ä»¥è°ƒè¯•ï¼š æ‰‹æœºç”µè„‘éƒ½è¿žä¸Šä»£ç† åœ¨ â€œDev Settingsâ€ ä¸­è®¾ç½® â€œDebug server host &amp; port for deviceâ€ï¼Œä¿®æ”¹ä¸ºä¸Šé¢çš„ä»£ç†åœ°å€ï¼ˆipsec0é®æŒ¡éƒ¨åˆ†ï¼‰ åœ¨è°ƒè¯•èœå•ä¸­ï¼Œé€‰æ‹© â€œDebug JS Remotelyâ€ã€‚ è§£å†³é—®é¢˜åˆ°äº†è¿™ä¸€æ­¥ï¼Œæˆ‘å·²ç»èƒ½å¤Ÿçœ‹åˆ°Logä»¥åŠæ‰“æ–­ç‚¹è¿›è¡Œè°ƒè¯•ï¼Œæœ€åŽå¾—å‡ºçš„ç»“è®ºæ˜¯ï¼šâ€œæœåŠ¡ç«¯çš„è°ƒè¯•ç»“è®ºçš„ç¡®æ˜¯æ­£ç¡®ï¼Œæ•°æ®å·²ç»é¡ºåˆ©æ‹¿åˆ°äº†ï¼Œè€Œæ˜¯æ˜¯æ­£ç¡®çš„ï¼Œé•¿è¿žæŽ¥ä¹Ÿæ²¡æœ‰é—®é¢˜â€ã€‚åˆ°è¿™é‡Œå·²ç»å¯ä»¥ç¡®è®¤æ˜¯å®¢æˆ·ç«¯çš„é”…ï¼Œè€Œä¸”æ˜¯è¿™ä¸ªé¡µé¢çš„ListViewç»„ä»¶çš„é”…ï¼Œå› ä¸ºéƒ½æ˜¯ç”¨React Nativeçš„ListViewï¼Œä¸ºä»€ä¹ˆå…¶å®ƒé¡µé¢æ²¡æœ‰é—®é¢˜ï¼Ÿ å†æ¬¡åˆ†æžReact Native çš„ ListView æ˜¯åŸºäºŽ ScrollView ç»„ä»¶å®žçŽ°çš„ï¼Œæ˜¾ç¤ºéƒ¨åˆ†å¼‚å¸¸ï¼Œåº”è¯¥æ˜¯ListViewé‡Œé¢çš„ScrollViewå‡ºäº†é—®é¢˜ï¼Œå¯¹æ¯”å…¶å®ƒæ¨¡å—ç”¨çš„ ListView ï¼Œå‘çŽ°äº†ä¸€ä¸ªååˆ†å¯ç–‘çš„åœ°æ–¹ï¼šListView ç»„ä»¶æä¾›çš„ â€œrenderScrollComponentâ€ å±žæ€§ï¼Œå…³äºŽè¿™ä¸ªè¿™ä¸ªå±žæ€§ï¼Œå®˜æ–¹æ–‡æ¡£æ˜¯è¿™æ ·è¯´çš„ï¼š renderScrollComponent function (props) =&gt; renderable æŒ‡å®šä¸€ä¸ªå‡½æ•°ï¼Œåœ¨å…¶ä¸­è¿”å›žä¸€ä¸ªå¯ä»¥æ»šåŠ¨çš„ç»„ä»¶ã€‚ListViewå°†ä¼šåœ¨è¯¥ç»„ä»¶å†…éƒ¨è¿›è¡Œæ¸²æŸ“ã€‚é»˜è®¤æƒ…å†µä¸‹ä¼šè¿”å›žä¸€ä¸ªåŒ…å«æŒ‡å®šå±žæ€§çš„ScrollViewã€‚ ç®€å•è¯´ï¼Œè¿™ä¸ªå±žæ€§å¯ä»¥è®©æˆ‘ä»¬è‡ªå®šä¹‰ListViewçš„æ»šåŠ¨ç»„ä»¶ï¼Œå¦‚æžœä¸è®¾ç½®çš„è¯ï¼Œå°±æ˜¯ä¸€ä¸ªé»˜è®¤çš„ScrollViewä½œä¸ºListViewçš„æ»šåŠ¨ç»„ä»¶ã€‚ å¾ˆä¸å‡‘å·§ï¼Œæˆ‘ä»¬æŒ‡å®šäº†è¿™ä¸ªå±žæ€§ï¼Œå› ä¸ºå¯¹äºŽèŠå¤©åˆ—è¡¨ï¼Œæœ€æ–°çš„æ¶ˆæ¯å†…å®¹éœ€è¦æ˜¾ç¤ºåœ¨åˆ—è¡¨çš„æœ€ä¸‹æ–¹ï¼ŒäºŽæ˜¯æˆ‘ä»¬ä½¿ç”¨ react-native-invertible-scroll-view è¿™ä¸ªç¬¬ä¸‰æ–¹åº“ï¼Œå°†è¿™ä¸ªé»˜è®¤çš„ScrollViewç¿»è½¬äº†è¿‡æ¥ï¼Œå®žçŽ°äº†æ–°æ¶ˆæ¯ä¸€ç›´åœ¨åº•éƒ¨ï¼Œæœ‰æ–°æ¶ˆæ¯ä¹Ÿç›´æŽ¥æ»šåŠ¨åˆ°æœ€åº•éƒ¨è¿™æ ·çš„æ•ˆæžœï¼ˆç±»ä¼¼ï¼šreact-native-gifted-chatï¼‰ã€‚ è¯å®žçŒœæƒ³è¦è¯æ˜Žä¸Šé¢çš„çŒœæƒ³å¾ˆç®€å•ï¼Œç›´æŽ¥åŽ»æŽ‰ListViewä¸­æŒ‡å®šçš„çš„ renderScrollComponent æ–¹æ³•ï¼Œç„¶åŽåˆ·æ–°ç•Œé¢ã€‚XåŒäº‹è¯´ï¼šâ€œæ˜¾ç¤ºå‡ºæ¥äº†ï¼Œä¸è¿‡æ–¹å‘æ˜¯åçš„â€ã€‚ è§£å†³é—®é¢˜æˆ‘ä»¬çœ‹çœ‹è¿™ä¸ªåº“æ˜¯å¦‚ä½•å°†ScrollViewç¿»è½¬è¿‡æ¥çš„ï¼Œæ‰¾åˆ°æ ¸å¿ƒæ–‡ä»¶ â€˜InvertibleScrollView.jsâ€™ ï¼Œçœ‹åˆ°å…³é”®ä»£ç ï¼š 1234567891011121314let styles = StyleSheet.create(&#123; verticallyInverted: &#123; flex: 1, transform: [ &#123; scaleY: -1 &#125;, ], &#125;, horizontallyInverted: &#123; flex: 1, transform: [ &#123; scaleX: -1 &#125;, ], &#125;,&#125;); åˆ°è¿™é‡Œå·²ç»ä¸€åˆ‡äº†ç„¶ï¼Œè¿™è´§ä½¿ç”¨ transform å±žæ€§ï¼Œåœ¨åž‚ç›´/æ°´å¹³æ–¹å‘ä¸Šç¿»è½¬åˆ†åˆ«ä½¿ç”¨ï¼š 123transform: [ &#123; scaleY: -1 &#125; ] //åž‚ç›´ç¿»è½¬ transform: [ &#123; scaleX: -1 &#125; ] //æ°´å¹³ç¿»è½¬ åˆ°è¿™é‡Œå·²ç»ç¡®è¯Šäº†ï¼Œtransform åœ¨P10ä¸Šå‡ºé—®é¢˜äº†ï¼Œè¿™ä¸ªé—®é¢˜ä¹Ÿå¯ä»¥åœ¨ React Native çš„ issues ä¸Šæ‰¾åˆ°ï¼š react-native-invertible-scroll-view not working on Huawei Android 7 devices. always set camera distance on transforms, to default 1280 if 0 ç›®å‰å·²ç»ç¡®è®¤æœ‰é—®é¢˜çš„æœºåž‹å¦‚ä¸‹ï¼š FRD-AL10ï¼ˆhonor 8ï¼‰ EMUI:5.0 android: 7.0MHA-AL00(Mate9) EMUI:5.0 android:7.0Huawei P10 VTR-L09, EMUI:5.0 Android 7.0 è§£å†³æ–¹æ³•æœ‰ä¸¤ç§ï¼š1ï¼‰åœ¨transformä¸­å¢žåŠ  perspective: 1280 (åœ¨æˆ‘çš„é¡¹ç›®é‡Œæ²¡æœ‰èµ·æ•ˆï¼ŒåŸºäºŽ React Native 0.35) 1transform: [ &#123; scaleY: -1, perspective: 1280 &#125; ] 2ï¼‰å¯¹äºŽAndroidï¼Œä½¿ç”¨è¿‡æ—¶çš„ {scaleY: -1} å±žæ€§ï¼Œè€Œä¸æ˜¯ transform: [ { scaleY: -1 } ]ï¼ŒiOSä¿æŒä¸å˜ 12345678910let styles = StyleSheet.create(&#123; verticallyInverted: Platform.select(&#123; ios: &#123;transform: [&#123;scaleY: -1&#125;]&#125;, android: &#123;scaleY: -1&#125;, &#125;), horizontallyInverted: Platform.select(&#123; ios: &#123;transform: [&#123;scaleX: -1&#125;]&#125;, android: &#123;scaleX: -1&#125;, &#125;),&#125;); æœ€åŽé™„ä¸Šä¿®å¤å¥½çš„ç¿»è½¬ScrollView: V1sk/react-native-invertible-scroll-view ç»“è¯­è¿™ä¸€æ³¢è°ƒè¯•è¿‡ç¨‹ååˆ†æ›²æŠ˜ï¼Œå¸Œæœ›å¤§å®¶ä¸ä¼šé‡åˆ°è¿™äº›å¥‡è‘©é—®é¢˜ã€‚å¦å¤–ï¼Œè¯„è®ºç³»ç»ŸåˆGGäº†ï¼Œç»§å¤šè¯´åœæ­¢æœåŠ¡ä¹‹åŽï¼Œç½‘æ˜“äº‘è·Ÿå¸–ä¹Ÿåœäº†ï¼Œè¯„è®ºæ•°æ®ä¹Ÿæ¸…äº†ï¼ŒçŽ°åœ¨å”¯æœ‰ç”¨Disqusäº†ï¼Œä¹Ÿæ˜¯éœ€è¦ Virtual Private Network æ‰èƒ½çœ‹åˆ°è¯„è®ºç³»ç»Ÿå“Ÿ~]]></content>
      <categories>
        <category>React Native</category>
      </categories>
      <tags>
        <tag>React Native</tag>
        <tag>React NativeæŠ€å·§</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å·§ç”¨Androidå¤šè¿›ç¨‹ï¼Œå¾®ä¿¡ï¼Œå¾®åšç­‰ä¸»æµAppéƒ½åœ¨ç”¨]]></title>
    <url>%2F2017%2F02%2F26%2FAIDL%2F</url>
    <content type="text"><![CDATA[å‰è¨€å¯¹äºŽè¿›ç¨‹çš„æ¦‚å¿µï¼Œæ¥åˆ°è¿™é‡Œçš„éƒ½æ˜¯ç¼–ç¨‹ä¿®ä»™ä¹‹äººï¼Œå°±ä¸å†å•°å—¦äº†ï¼Œç›¸ä¿¡å¤§å®¶å€’ç€ã€è·³ç€ã€èººç€ã€å„ç§å§¿åŠ¿éƒ½èƒ½èƒŒå‡ºæ¥ã€‚ ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å¤šè¿›ç¨‹ï¼Œä¸€ä¸ªè¿›ç¨‹ä¸å°±å¯ä»¥äº†å—ï¼Ÿç›¸ä¿¡å¾ˆå¤šåŒå­¦åœ¨å®žé™…å¼€å‘ä¸­ï¼ŒåŸºæœ¬éƒ½ä¸ä¼šåŽ»ç»™appåˆ’åˆ†è¿›ç¨‹ï¼Œè€Œä¸”ï¼Œåœ¨Androidä¸­ä½¿ç”¨å¤šè¿›ç¨‹ï¼Œè¿˜å¯èƒ½éœ€è¦ç¼–å†™é¢å¤–çš„è¿›ç¨‹é€šè®¯ä»£ç ï¼Œè¿˜å¯èƒ½å¸¦æ¥é¢å¤–çš„Bugï¼Œè¿™æ— ç–‘åŠ å¤§äº†å¼€å‘çš„å·¥ä½œé‡ï¼Œåœ¨å¾ˆå¤šåˆ›ä¸šå…¬å¸ä¸­å·¥æœŸä¹Ÿä¸å…è®¸ï¼Œè¿™å¯¼è‡´äº†æ•´ä¸ªappéƒ½åœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­ã€‚ æ•´ä¸ªappéƒ½åœ¨ä¸€ä¸ªè¿›ç¨‹æœ‰ä»€ä¹ˆå¼Šç«¯ï¼Ÿåœ¨Androidä¸­ï¼Œè™šæ‹Ÿæœºåˆ†é…ç»™å„ä¸ªè¿›ç¨‹çš„è¿è¡Œå†…å­˜æ˜¯æœ‰é™åˆ¶å€¼çš„ï¼ˆè¿™ä¸ªå€¼å¯ä»¥æ˜¯32Mï¼Œ48Mï¼Œ64Mç­‰ï¼Œæ ¹æ®æœºåž‹è€Œå®šï¼‰ï¼Œè¯•æƒ³ä¸€ä¸‹ï¼Œå¦‚æžœåœ¨appä¸­ï¼Œå¢žåŠ äº†ä¸€ä¸ªå¾ˆå¸¸ç”¨çš„å›¾ç‰‡é€‰æ‹©æ¨¡å—ç”¨äºŽä¸Šä¼ å›¾ç‰‡æˆ–è€…å¤´åƒï¼ŒåŠ è½½å¤§é‡Bitmapä¼šä½¿appçš„å†…å­˜å ç”¨è¿…é€Ÿå¢žåŠ ï¼Œå¦‚æžœä½ è¿˜æŠŠæŸ¥çœ‹è¿‡çš„å›¾ç‰‡ç¼“å­˜åœ¨äº†å†…å­˜ä¸­ï¼Œé‚£ä¹ˆOOMçš„é£Žé™©å°†ä¼šå¤§å¤§å¢žåŠ ï¼Œå¦‚æžœæ­¤æ—¶è¿˜éœ€è¦ä½¿ç”¨WebViewåŠ è½½ä¸€æ³¢ç½‘é¡µï¼Œæˆ‘å°±é—®ä½ æ€•ä¸æ€•ï¼ å¾®ä¿¡ï¼Œå¾®åšç­‰ä¸»æµappæ˜¯å¦‚ä½•è§£å†³è¿™äº›é—®é¢˜çš„ï¼Ÿå¾®ä¿¡ç§»åŠ¨å¼€å‘å›¢é˜Ÿåœ¨ ã€ŠAndroidå†…å­˜ä¼˜åŒ–æ‚è°ˆã€‹ ä¸€æ–‡ä¸­å°±è¯´åˆ°ï¼šâ€œå¯¹äºŽwebviewï¼Œå›¾åº“ç­‰ï¼Œç”±äºŽå­˜åœ¨å†…å­˜ç³»ç»Ÿæ³„éœ²æˆ–è€…å ç”¨å†…å­˜è¿‡å¤šçš„é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨å•ç‹¬çš„è¿›ç¨‹ã€‚å¾®ä¿¡å½“å‰ä¹Ÿä¼šæŠŠå®ƒä»¬æ”¾åœ¨å•ç‹¬çš„toolsè¿›ç¨‹ä¸­â€ã€‚ ä¸‹é¢æˆ‘ä»¬ä½¿ç”¨adbæŸ¥çœ‹ä¸€ä¸‹å¾®ä¿¡å’Œå¾®åšçš„è¿›ç¨‹ä¿¡æ¯ï¼ˆAndroid 5.0ä»¥ä¸‹ç‰ˆæœ¬å¯ç›´æŽ¥åœ¨â€œè®¾ç½® -&gt; åº”ç”¨ç¨‹åºâ€ç›¸å…³æ¡ç›®ä¸­æŸ¥çœ‹ï¼‰ï¼š è¿›å…¥adb shellåŽï¼Œä½¿ç”¨ â€œps | grep æ¡ç›®åç§°â€ å¯ä»¥è¿‡æ»¤å‡ºæƒ³è¦æŸ¥çœ‹çš„è¿›ç¨‹ã€‚å¯ä»¥çœ‹åˆ°ï¼Œå¾®ä¿¡çš„ç¡®æœ‰ä¸€ä¸ªtoolsè¿›ç¨‹ï¼Œè€Œæ–°æµªå¾®åšä¹Ÿæœ‰imageç›¸å…³çš„è¿›ç¨‹ï¼Œè€Œä¸”å®ƒä»¬å½“ä¸­è¿˜æœ‰å¥½äº›å…¶å®ƒçš„è¿›ç¨‹ï¼Œæ¯”å¦‚å¾®ä¿¡çš„pushè¿›ç¨‹ï¼Œå¾®åšçš„remoteè¿›ç¨‹ç­‰ï¼Œè¿™é‡Œå¯ä»¥çœ‹å‡ºï¼Œä»–ä»¬ä¸å•å•åªæ˜¯æŠŠä¸Šè¿°çš„WebViewã€å›¾åº“ç­‰æ”¾åˆ°å•ç‹¬çš„è¿›ç¨‹ï¼Œè¿˜æœ‰æŽ¨é€æœåŠ¡ç­‰ä¹Ÿæ˜¯è¿è¡Œåœ¨ç‹¬ç«‹çš„è¿›ç¨‹ä¸­çš„ã€‚ä¸€ä¸ªæ¶ˆæ¯æŽ¨é€æœåŠ¡ï¼Œä¸ºäº†ä¿è¯ç¨³å®šæ€§ï¼Œå¯èƒ½éœ€è¦å’ŒUIè¿›ç¨‹åˆ†ç¦»ï¼Œåˆ†ç¦»åŽå³ä½¿UIè¿›ç¨‹é€€å‡ºã€Crashæˆ–è€…å‡ºçŽ°å†…å­˜æ¶ˆè€—è¿‡é«˜ç­‰æƒ…å†µï¼Œä»ä¸å½±å“æ¶ˆæ¯æŽ¨é€æœåŠ¡ã€‚ å¯è§ï¼Œåˆç†ä½¿ç”¨å¤šè¿›ç¨‹ä¸ä»…ä»…æ˜¯æœ‰å¤šå¤§å¥½å¤„çš„é—®é¢˜ï¼Œæˆ‘ä¸ªäººè®¤ä¸ºè€Œä¸”æ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚ æ‰€ä»¥è¯´ï¼Œæˆ‘ä»¬æœ€å¥½è¿˜æ˜¯æ ¹æ®è‡ªèº«æƒ…å†µï¼Œè€ƒè™‘ä¸€ä¸‹æ˜¯å¦éœ€è¦æ‹†åˆ†è¿›ç¨‹ã€‚è¿™ä¹Ÿæ˜¯æœ¬æ–‡çš„åˆè¡·ï¼šç»™å¤§å®¶æä¾›ä¸€ä¸ªå¤šè¿›ç¨‹çš„å‚è€ƒæ€è·¯ï¼Œåœ¨é‡åˆ°ä¸Šè¿°é—®é¢˜å’Œåœºæ™¯çš„æ—¶å€™ï¼Œå¯ä»¥è€ƒè™‘ç”¨å¤šè¿›ç¨‹çš„æ–¹æ³•æ¥è§£å†³é—®é¢˜ï¼Œåˆæˆ–è€…ï¼Œåœ¨é¢è¯•çš„æ—¶å€™ï¼Œè·Ÿé¢è¯•å®˜èŠåˆ°è¿™æ–¹é¢çš„çŸ¥è¯†æ—¶å€™ä¹Ÿä¸è‡³äºŽå°´å°¬ã€‚ ä¸ºä»€ä¹ˆéœ€è¦â€œè·¨è¿›ç¨‹é€šè®¯â€ï¼ŸAndroidçš„è¿›ç¨‹ä¸Žè¿›ç¨‹ä¹‹é—´é€šè®¯ï¼Œæœ‰äº›ä¸éœ€è¦æˆ‘ä»¬é¢å¤–ç¼–å†™é€šè®¯ä»£ç ï¼Œä¾‹å¦‚ï¼šæŠŠé€‰æ‹©å›¾ç‰‡æ¨¡å—æ”¾åˆ°ç‹¬ç«‹çš„è¿›ç¨‹ï¼Œæˆ‘ä»¬ä»å¯ä»¥ä½¿ç”¨startActivityForResultæ–¹æ³•ï¼Œå°†é€‰ä¸­çš„å›¾ç‰‡æ”¾åˆ°Bundleä¸­ï¼Œä½¿ç”¨Intentä¼ é€’å³å¯ã€‚ï¼ˆçœ‹åˆ°è¿™é‡Œï¼Œä½ è¿˜ä¸æ‰“ç®—æŠŠä½ é¡¹ç›®çš„å›¾ç‰‡é€‰æ‹©å¼„åˆ°ç‹¬ç«‹è¿›ç¨‹ä¹ˆï¼Ÿï¼‰ ä½†æ˜¯å¯¹äºŽæŠŠâ€œæ¶ˆæ¯æŽ¨é€Serviceâ€æ”¾åˆ°ç‹¬ç«‹çš„è¿›ç¨‹ï¼Œè¿™ä¸ªä¸šåŠ¡å°±ç¨å¾®å¤æ‚ç‚¹äº†ï¼Œè¿™ä¸ªæ—¶å€™å¯èƒ½ä¼šå‘ç”ŸActivityè·ŸServiceä¼ é€’å¯¹è±¡ï¼Œè°ƒç”¨Serviceæ–¹æ³•ç­‰ä¸€ç³»åˆ—å¤æ‚æ“ä½œã€‚ ç”±äºŽå„ä¸ªè¿›ç¨‹è¿è¡Œåœ¨ç›¸å¯¹ç‹¬ç«‹çš„å†…å­˜ç©ºé—´ï¼Œæ‰€ä»¥å®ƒä»¬æ˜¯ä¸èƒ½ç›´æŽ¥é€šè®¯çš„ï¼Œå› ä¸ºç¨‹åºé‡Œçš„å˜é‡ã€å¯¹è±¡ç­‰åˆå§‹åŒ–åŽéƒ½æ˜¯å…·æœ‰å†…å­˜åœ°å€çš„ï¼Œä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œè¯»å–ä¸€ä¸ªå˜é‡çš„å€¼ï¼Œæœ¬è´¨æ˜¯æ‰¾åˆ°å˜é‡çš„å†…å­˜åœ°å€ï¼Œå–å‡ºå­˜æ”¾çš„å€¼ã€‚ä¸åŒçš„è¿›ç¨‹ï¼Œè¿è¡Œåœ¨ç›¸äº’ç‹¬ç«‹çš„å†…å­˜ï¼ˆå…¶å®žå°±å¯ä»¥ç†è§£ä¸ºä¸¤ä¸ªä¸åŒçš„åº”ç”¨ç¨‹åºï¼‰ï¼Œæ˜¾ç„¶ä¸èƒ½ç›´æŽ¥å¾—çŸ¥å¯¹æ–¹å˜é‡ã€å¯¹è±¡çš„å†…å­˜åœ°å€ï¼Œè¿™æ ·çš„è¯ä¹Ÿè‡ªç„¶ä¸èƒ½è®¿é—®å¯¹æ–¹çš„å˜é‡ï¼Œå¯¹è±¡ç­‰ã€‚æ­¤æ—¶ä¸¤ä¸ªè¿›ç¨‹è¿›è¡Œäº¤äº’ï¼Œå°±éœ€è¦ä½¿ç”¨è·¨è¿›ç¨‹é€šè®¯çš„æ–¹å¼åŽ»å®žçŽ°ã€‚ç®€å•è¯´ï¼Œè·¨è¿›ç¨‹é€šè®¯å°±æ˜¯ä¸€ç§è®©è¿›ç¨‹ä¸Žè¿›ç¨‹ä¹‹é—´å¯ä»¥è¿›è¡Œäº¤äº’çš„æŠ€æœ¯ã€‚ è·¨è¿›ç¨‹é€šè®¯çš„æ–¹å¼æœ‰å“ªäº›ï¼Ÿ å››å¤§ç»„ä»¶é—´ä¼ é€’Bundle; ä½¿ç”¨æ–‡ä»¶å…±äº«æ–¹å¼ï¼Œå¤šè¿›ç¨‹è¯»å†™ä¸€ä¸ªç›¸åŒçš„æ–‡ä»¶ï¼ŒèŽ·å–æ–‡ä»¶å†…å®¹è¿›è¡Œäº¤äº’ï¼› ä½¿ç”¨Messengerï¼Œä¸€ç§è½»é‡çº§çš„è·¨è¿›ç¨‹é€šè®¯æ–¹æ¡ˆï¼Œåº•å±‚ä½¿ç”¨AIDLå®žçŽ°ï¼ˆå®žçŽ°æ¯”è¾ƒç®€å•ï¼Œåšä¸»å¼€å§‹æœ¬æ–‡å‰ä¹Ÿæƒ³äº†ä¸€ä¸‹æ˜¯å¦è¦è¯´ä¸€ä¸‹è¿™ä¸ªä¸œè¥¿ï¼Œæœ€åŽè¿˜æ˜¯è§‰å¾—æ²¡æœ‰è¿™ä¸ªå¿…è¦ï¼ŒGoogleä¸€ä¸‹å°±èƒ½è§£å†³çš„é—®é¢˜ï¼Œå°±ä¸å•°å—¦äº†ï¼‰ï¼› ä½¿ç”¨AIDL(Android Interface Definition Language)ï¼ŒAndroidæŽ¥å£å®šä¹‰è¯­è¨€ï¼Œç”¨äºŽå®šä¹‰è·¨è¿›ç¨‹é€šè®¯çš„æŽ¥å£ï¼› ä½¿ç”¨ContentProviderï¼Œå¸¸ç”¨äºŽå¤šè¿›ç¨‹å…±äº«æ•°æ®ï¼Œæ¯”å¦‚ç³»ç»Ÿçš„ç›¸å†Œï¼ŒéŸ³ä¹ç­‰ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ContentProviderè®¿é—®åˆ°ï¼› ä½¿ç”¨Socketä¼ è¾“æ•°æ®ã€‚ æŽ¥ä¸‹æ¥æœ¬æ–‡å°†é‡ç‚¹ä»‹ç»ä½¿ç”¨AIDLè¿›è¡Œå¤šè¿›ç¨‹é€šè®¯ï¼Œå› ä¸ºAIDLæ˜¯Androidæä¾›ç»™æˆ‘ä»¬çš„æ ‡å‡†è·¨è¿›ç¨‹é€šè®¯APIï¼Œéžå¸¸çµæ´»ä¸”å¼ºå¤§ï¼ˆè²Œä¼¼é¢è¯•ä¹Ÿç»å¸¸ä¼šé—®åˆ°ï¼Œä½†æ˜¯çœŸæ­£ç”¨åˆ°çš„ä¹Ÿä¸å¤šâ€¦ï¼‰ã€‚ä¸Šé¢æ‰€è¯´çš„Messengerä¹Ÿæ˜¯ä½¿ç”¨AIDLå®žçŽ°çš„ä¸€ç§è·¨è¿›ç¨‹æ–¹å¼ï¼ŒMessengeré¡¾åæ€ä¹‰ï¼Œå°±åƒæ˜¯ä¸€ç§ä¸²è¡Œçš„æ¶ˆæ¯æœºåˆ¶ï¼Œå®ƒæ˜¯ä¸€ç§è½»é‡çº§çš„IPCæ–¹æ¡ˆï¼Œå¯ä»¥åœ¨ä¸åŒè¿›ç¨‹ä¸­ä¼ é€’Messageå¯¹è±¡ï¼Œæˆ‘ä»¬åœ¨Messageä¸­æ”¾å…¥éœ€è¦ä¼ é€’çš„æ•°æ®å³å¯è½»æ¾å®žçŽ°è¿›ç¨‹é—´é€šè®¯ã€‚ä½†æ˜¯å½“æˆ‘ä»¬éœ€è¦è°ƒç”¨æœåŠ¡ç«¯æ–¹æ³•ï¼Œæˆ–è€…å­˜åœ¨å¹¶å‘è¯·æ±‚ï¼Œé‚£ä¹ˆMessengerå°±ä¸åˆé€‚äº†ã€‚è€Œå››å¤§ç»„ä»¶ä¼ é€’Bundleï¼Œè¿™ä¸ªå°±ä¸éœ€è¦è§£é‡Šäº†ï¼ŒæŠŠéœ€è¦ä¼ é€’çš„æ•°æ®ï¼Œç”¨Intentå°è£…èµ·æ¥ä¼ é€’å³å¯ï¼Œå…¶å®ƒæ–¹å¼ä¸åœ¨æœ¬æ–‡çš„è®¨è®ºèŒƒå›´ã€‚ ä¸‹é¢å¼€å§‹å¯¹AIDLçš„è®²è§£ï¼Œå„ä½é“å‹å‡†å¤‡å¥½æ¸¡åŠ«äº†å—ï¼Ÿ ä½¿ç”¨AIDLå®žçŽ°ä¸€ä¸ªå¤šè¿›ç¨‹æ¶ˆæ¯æŽ¨é€åƒå›¾ç‰‡é€‰æ‹©è¿™æ ·çš„å¤šè¿›ç¨‹éœ€æ±‚ï¼Œå¯èƒ½å¹¶ä¸éœ€è¦æˆ‘ä»¬é¢å¤–ç¼–å†™è¿›ç¨‹é€šè®¯çš„ä»£ç ï¼Œä½¿ç”¨å››å¤§ç»„ä»¶ä¼ è¾“Bundleå°±è¡Œäº†ï¼Œä½†æ˜¯åƒæŽ¨é€æœåŠ¡è¿™ç§éœ€æ±‚ï¼Œè¿›ç¨‹ä¸Žè¿›ç¨‹ä¹‹é—´éœ€è¦é«˜åº¦çš„äº¤äº’ï¼Œæ­¤æ—¶å°±ç»•ä¸è¿‡è¿›ç¨‹é€šè®¯è¿™ä¸€æ­¥äº†ã€‚ä¸‹é¢æˆ‘ä»¬å°±ç”¨å³æ—¶èŠå¤©è½¯ä»¶ä¸ºä¾‹ï¼Œæ‰‹åŠ¨åŽ»å®žçŽ°ä¸€ä¸ªå¤šè¿›ç¨‹çš„æŽ¨é€ä¾‹å­ï¼Œå…·ä½“éœ€æ±‚å¦‚ä¸‹ï¼š UIå’Œæ¶ˆæ¯æŽ¨é€çš„Serviceåˆ†ä¸¤ä¸ªè¿›ç¨‹ï¼› UIè¿›ç¨‹ç”¨äºŽå±•ç¤ºå…·ä½“çš„æ¶ˆæ¯æ•°æ®ï¼ŒæŠŠç”¨æˆ·å‘é€çš„æ¶ˆæ¯ï¼Œä¼ é€’åˆ°æ¶ˆæ¯Serviceï¼Œç„¶åŽå‘é€åˆ°è¿œç¨‹æœåŠ¡å™¨ï¼› Serviceè´Ÿè´£æ”¶å‘æ¶ˆæ¯ï¼Œå¹¶å’Œè¿œç¨‹æœåŠ¡å™¨ä¿æŒé•¿è¿žæŽ¥ï¼ŒUIè¿›ç¨‹å¯é€šè¿‡Serviceå‘é€æ¶ˆæ¯åˆ°è¿œç¨‹æœåŠ¡å™¨ï¼ŒServiceæ”¶åˆ°è¿œç¨‹æœåŠ¡å™¨æ¶ˆæ¯é€šçŸ¥UIè¿›ç¨‹ï¼› å³ä½¿UIè¿›ç¨‹é€€å‡ºäº†ï¼ŒServiceä»éœ€è¦ä¿æŒè¿è¡Œï¼Œæ”¶å–æœåŠ¡å™¨æ¶ˆæ¯ã€‚ å®žçŽ°æ€è·¯å…ˆæ¥æ•´ç†ä¸€ä¸‹å®žçŽ°æ€è·¯ï¼š åˆ›å»ºUIè¿›ç¨‹ï¼ˆä¸‹æ–‡ç»Ÿç§°ä¸ºå®¢æˆ·ç«¯ï¼‰ï¼› åˆ›å»ºæ¶ˆæ¯Serviceï¼ˆä¸‹æ–‡ç»Ÿç§°ä¸ºæœåŠ¡ç«¯ï¼‰ï¼› æŠŠæœåŠ¡ç«¯é…ç½®åˆ°ç‹¬ç«‹çš„è¿›ç¨‹(AndroidManifest.xmlä¸­æŒ‡å®šprocessæ ‡ç­¾)ï¼› å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯è¿›è¡Œç»‘å®šï¼ˆbindServiceï¼‰ï¼› è®©å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å…·å¤‡äº¤äº’çš„èƒ½åŠ›ã€‚(AIDLä½¿ç”¨) ä¾‹å­å…·ä½“å®žçŽ°ä¸ºäº†é˜…è¯»æ–¹ä¾¿ï¼Œä¸‹æ–‡ä¸­ä»£ç å°†çœç•¥éžé‡ç‚¹éƒ¨åˆ†ï¼Œå¯ä»¥æŠŠæœ¬æ–‡å®Œæ•´ä»£ç Cloneåˆ°æœ¬åœ°å†çœ‹æ–‡ç« ï¼šhttps://github.com/V1sk/AIDL Step0. AIDLè°ƒç”¨æµç¨‹æ¦‚è§ˆå¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥æ¦‚æ‹¬ä¸€ä¸‹ä½¿ç”¨AIDLè¿›è¡Œå¤šè¿›ç¨‹è°ƒç”¨çš„æ•´ä¸ªæµç¨‹ï¼š å®¢æˆ·ç«¯ä½¿ç”¨bindServiceæ–¹æ³•ç»‘å®šæœåŠ¡ç«¯ï¼› æœåŠ¡ç«¯åœ¨onBindæ–¹æ³•è¿”å›žBinderå¯¹è±¡ï¼› å®¢æˆ·ç«¯æ‹¿åˆ°æœåŠ¡ç«¯è¿”å›žçš„Binderå¯¹è±¡è¿›è¡Œè·¨è¿›ç¨‹æ–¹æ³•è°ƒç”¨ï¼›æ•´ä¸ªAIDLè°ƒç”¨è¿‡ç¨‹æ¦‚æ‹¬èµ·æ¥å°±ä»¥ä¸Š3ä¸ªæ­¥éª¤ï¼Œä¸‹æ–‡ä¸­æˆ‘ä»¬ä½¿ç”¨ä¸Šé¢æè¿°çš„ä¾‹å­ï¼Œæ¥é€æ­¥åˆ†è§£è¿™äº›æ­¥éª¤ï¼Œå¹¶è®²è¿°å…¶ä¸­çš„ç»†èŠ‚ã€‚ Step1.å®¢æˆ·ç«¯ä½¿ç”¨bindServiceæ–¹æ³•ç»‘å®šæœåŠ¡ç«¯1.1 åˆ›å»ºå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ï¼ŒæŠŠæœåŠ¡ç«¯é…ç½®åˆ°å¦å¤–çš„è¿›ç¨‹ åˆ›å»ºå®¢æˆ·ç«¯ -&gt; MainActivityï¼› åˆ›å»ºæœåŠ¡ç«¯ -&gt; MessageService; æŠŠæœåŠ¡ç«¯é…ç½®åˆ°å¦å¤–çš„è¿›ç¨‹ -&gt; android:process=â€:remoteâ€ ä¸Šé¢æè¿°çš„å®¢æˆ·ç«¯ã€æœåŠ¡ç«¯ã€ä»¥åŠæŠŠæœåŠ¡ç«¯é…ç½®åˆ°å¦å¤–è¿›ç¨‹ï¼Œä½“çŽ°åœ¨AndroidManifest.xmlä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š 12345678910111213&lt;manifest ...&gt; &lt;application ...&gt; &lt;activity android:name=".ui.MainActivity"/&gt; &lt;service android:name=".service.MessageService" android:enabled="true" android:exported="true" android:process=":remote" /&gt; &lt;/application&gt;&lt;/manifest&gt; å¼€å¯å¤šè¿›ç¨‹çš„æ–¹æ³•å¾ˆç®€å•ï¼Œåªéœ€è¦ç»™å››å¤§ç»„ä»¶æŒ‡å®šandroid:processæ ‡ç­¾ã€‚ 1.2 ç»‘å®šMessageServiceåˆ°MainActivityåˆ›å»ºMessageServiceæ­¤æ—¶çš„MessageServiceå°±æ˜¯åˆšåˆ›å»ºçš„æ¨¡æ ·ï¼ŒonBindä¸­è¿”å›žäº†nullï¼Œä¸‹ä¸€æ­¥ä¸­æˆ‘ä»¬å°†è¿”å›žä¸€ä¸ªå¯æ“ä½œçš„å¯¹è±¡ç»™å®¢æˆ·ç«¯ã€‚ 1234567891011public class MessageService extends Service &#123; public MessageService() &#123; &#125; @Override public IBinder onBind(Intent intent) &#123; return null; &#125;&#125; å®¢æˆ·ç«¯MainActivityè°ƒç”¨bindServiceæ–¹æ³•ç»‘å®šMessageServiceè¿™ä¸€æ­¥å…¶å®žæ˜¯å±žäºŽServiceç»„ä»¶ç›¸å…³çš„çŸ¥è¯†ï¼Œåœ¨è¿™é‡Œå°±æ¯”è¾ƒç®€å•åœ°è¯´ä¸€ä¸‹ï¼Œå¯åŠ¨æœåŠ¡å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼ï¼š ä½¿ç”¨bindServiceæ–¹æ³• -&gt; bindService(Intent service, ServiceConnection conn, int flags)ï¼› ä½¿ç”¨startServiceæ–¹æ³• -&gt; startService(Intent service); bindService &amp; startServiceåŒºåˆ«ï¼šä½¿ç”¨bindServiceæ–¹å¼ï¼Œå¤šä¸ªClientå¯ä»¥åŒæ—¶bindä¸€ä¸ªServiceï¼Œä½†æ˜¯å½“æ‰€æœ‰Client unbindåŽï¼ŒServiceä¼šé€€å‡ºï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œå¦‚æžœå¸Œæœ›å’ŒServiceäº¤äº’ï¼Œä¸€èˆ¬ä½¿ç”¨bindServiceæ–¹æ³•ï¼Œä½¿ç”¨onServiceConnectedä¸­çš„IBinderå¯¹è±¡å¯ä»¥å’ŒServiceè¿›è¡Œäº¤äº’ï¼Œä¸éœ€è¦å’ŒServiceäº¤äº’çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨startServiceæ–¹æ³•å³å¯ã€‚ æ­£å¦‚ä¸Šé¢æ‰€è¯´ï¼Œæˆ‘ä»¬æ˜¯è¦å’ŒServiceäº¤äº’çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä½¿ç”¨bindServiceæ–¹æ³•ï¼Œä½†æ˜¯æˆ‘ä»¬å¸Œæœ›unbindåŽServiceä»ä¿æŒè¿è¡Œï¼Œè¿™æ ·çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥åŒæ—¶è°ƒç”¨bindServiceå’ŒstartServiceï¼ˆæ¯”å¦‚åƒæœ¬ä¾‹å­ä¸­çš„æ¶ˆæ¯æœåŠ¡ï¼Œé€€å‡ºUIè¿›ç¨‹ï¼ŒServiceä»éœ€è¦æŽ¥æ”¶åˆ°æ¶ˆæ¯ï¼‰ï¼Œä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243public class MainActivity extends AppCompatActivity &#123; private static final String TAG = "MainActivity"; @Override protected void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); setContentView(R.layout.activity_main); setupService(); &#125; /** * unbindService */ @Override protected void onDestroy() &#123; unbindService(serviceConnection); super.onDestroy(); &#125; /** * bindService &amp; startService */ private void setupService() &#123; Intent intent = new Intent(this, MessageService.class); bindService(intent, serviceConnection, Context.BIND_AUTO_CREATE); startService(intent); &#125; ServiceConnection serviceConnection = new ServiceConnection() &#123; @Override public void onServiceConnected(ComponentName name, IBinder service) &#123; Log.d(TAG, "onServiceConnected"); &#125; @Override public void onServiceDisconnected(ComponentName name) &#123; Log.d(TAG, "onServiceDisconnected"); &#125; &#125;;&#125; Stpe2.æœåŠ¡ç«¯åœ¨onBindæ–¹æ³•è¿”å›žBinderå¯¹è±¡2.1 é¦–å…ˆï¼Œä»€ä¹ˆæ˜¯Binder?è¦è¯´Binderï¼Œé¦–å…ˆè¦è¯´ä¸€ä¸‹IBinderè¿™ä¸ªæŽ¥å£ï¼ŒIBinderæ˜¯è¿œç¨‹å¯¹è±¡çš„åŸºç¡€æŽ¥å£ï¼Œè½»é‡çº§çš„è¿œç¨‹è¿‡ç¨‹è°ƒç”¨æœºåˆ¶çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œè¯¥æŽ¥å£æè¿°äº†ä¸Žè¿œç¨‹å¯¹è±¡äº¤äº’çš„æŠ½è±¡åè®®ï¼Œè€ŒBinderå®žçŽ°äº†IBinderæŽ¥å£ï¼Œç®€å•è¯´ï¼ŒBinderå°±æ˜¯Android SDKä¸­å†…ç½®çš„ä¸€ä¸ªå¤šè¿›ç¨‹é€šè®¯å®žçŽ°ç±»ï¼Œåœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸ç”¨ä¹Ÿä¸è¦åŽ»å®žçŽ°IBinderï¼Œè€Œæ˜¯ç»§æ‰¿Binderè¿™ä¸ªç±»å³å¯å®žçŽ°å¤šè¿›ç¨‹é€šè®¯ã€‚ 2.2 å…¶æ¬¡ï¼Œè¿™ä¸ªéœ€è¦åœ¨onBindæ–¹æ³•è¿”å›žçš„Binderå¯¹è±¡ä»Žä½•è€Œæ¥ï¼Ÿåœ¨è¿™é‡Œå°±è¦å¼•å‡ºæœ¬æ–‡ä¸­çš„ä¸»é¢˜äº†â€”â€”AIDLå¤šè¿›ç¨‹ä¸­ä½¿ç”¨çš„Binderå¯¹è±¡ï¼Œä¸€èˆ¬é€šè¿‡æˆ‘ä»¬å®šä¹‰å¥½çš„ .adil æŽ¥å£æ–‡ä»¶è‡ªåŠ¨ç”Ÿæˆï¼Œå½“ç„¶ä½ å¯ä»¥èµ°é‡Žè·¯å­ï¼Œç›´æŽ¥æ‰‹åŠ¨ç¼–å†™è¿™ä¸ªè·¨è¿›ç¨‹é€šè®¯æ‰€éœ€çš„Binderç±»ï¼Œå…¶æœ¬è´¨æ— éžå°±æ˜¯ä¸€ä¸ªç»§æ‰¿äº†Binderçš„ç±»ï¼Œé‰´äºŽé‡Žè·¯å­èµ°èµ·æ¥éº»çƒ¦ï¼Œè€Œä¸”éƒ½æ˜¯é‡å¤æ­¥éª¤çš„å·¥ä½œï¼ŒGoogleæä¾›äº† AIDL æŽ¥å£æ¥å¸®æˆ‘ä»¬è‡ªåŠ¨ç”ŸæˆBinderè¿™æ¡æ­£è·¯ï¼Œä¸‹æ–‡ä¸­æˆ‘ä»¬å›´ç»• AIDL è¿™æ¡æ­£è·¯ç»§ç»­å±•å¼€è®¨è®ºï¼ˆå¯ä¸èƒ½æŠŠäººç»™å¸¦åäº†æ˜¯å§ðŸ™ƒï¼‰ 2.3 å®šä¹‰AIDLæŽ¥å£å¾ˆæ˜Žæ˜¾ï¼ŒæŽ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦æžä¸€æ³¢ä¸Šé¢è¯´çš„Binderï¼Œè®©å®¢æˆ·ç«¯å¯ä»¥è°ƒç”¨åˆ°æœåŠ¡ç«¯çš„æ–¹æ³•ï¼Œè€Œè¿™ä¸ªBinderåˆæ˜¯é€šè¿‡AIDLæŽ¥å£è‡ªåŠ¨ç”Ÿæˆï¼Œé‚£æˆ‘ä»¬å°±å…ˆä»ŽAIDLæžèµ·ï¼Œæžä¹‹å‰å…ˆçœ‹çœ‹æ³¨æ„äº‹é¡¹ï¼Œä»¥å…å‡ºäº‹æ•…ï¼š AIDLæ”¯æŒçš„æ•°æ®ç±»åž‹ï¼š Java ç¼–ç¨‹è¯­è¨€ä¸­çš„æ‰€æœ‰åŸºæœ¬æ•°æ®ç±»åž‹ï¼ˆå¦‚ intã€longã€charã€boolean ç­‰ç­‰ï¼‰ Stringå’ŒCharSequence Parcelableï¼šå®žçŽ°äº†ParcelableæŽ¥å£çš„å¯¹è±¡ Listï¼šå…¶ä¸­çš„å…ƒç´ éœ€è¦è¢«AIDLæ”¯æŒï¼Œå¦ä¸€ç«¯å®žé™…æŽ¥æ”¶çš„å…·ä½“ç±»å§‹ç»ˆæ˜¯ ArrayListï¼Œä½†ç”Ÿæˆçš„æ–¹æ³•ä½¿ç”¨çš„æ˜¯ List æŽ¥å£ Mapï¼šå…¶ä¸­çš„å…ƒç´ éœ€è¦è¢«AIDLæ”¯æŒï¼ŒåŒ…æ‹¬ key å’Œ valueï¼Œå¦ä¸€ç«¯å®žé™…æŽ¥æ”¶çš„å…·ä½“ç±»å§‹ç»ˆæ˜¯ HashMapï¼Œä½†ç”Ÿæˆçš„æ–¹æ³•ä½¿ç”¨çš„æ˜¯ Map æŽ¥å£ å…¶ä»–æ³¨æ„äº‹é¡¹ï¼š åœ¨AIDLä¸­ä¼ é€’çš„å¯¹è±¡ï¼Œå¿…é¡»å®žçŽ°Parcelableåºåˆ—åŒ–æŽ¥å£ï¼› åœ¨AIDLä¸­ä¼ é€’çš„å¯¹è±¡ï¼Œéœ€è¦åœ¨ç±»æ–‡ä»¶ç›¸åŒè·¯å¾„ä¸‹ï¼Œåˆ›å»ºåŒåã€ä½†æ˜¯åŽç¼€ä¸º.aidlçš„æ–‡ä»¶ï¼Œå¹¶åœ¨æ–‡ä»¶ä¸­ä½¿ç”¨parcelableå…³é”®å­—å£°æ˜Žè¿™ä¸ªç±»ï¼› è·Ÿæ™®é€šæŽ¥å£çš„åŒºåˆ«ï¼šåªèƒ½å£°æ˜Žæ–¹æ³•ï¼Œä¸èƒ½å£°æ˜Žå˜é‡ï¼› æ‰€æœ‰éžåŸºç¡€æ•°æ®ç±»åž‹å‚æ•°éƒ½éœ€è¦æ ‡å‡ºæ•°æ®èµ°å‘çš„æ–¹å‘æ ‡è®°ã€‚å¯ä»¥æ˜¯ inã€out æˆ– inoutï¼ŒåŸºç¡€æ•°æ®ç±»åž‹é»˜è®¤åªèƒ½æ˜¯ inï¼Œä¸èƒ½æ˜¯å…¶ä»–æ–¹å‘ã€‚ ä¸‹é¢ç»§ç»­æˆ‘ä»¬çš„ä¾‹å­ï¼Œå¼€å§‹å¯¹AIDLçš„è®²è§£~ 2.4 åˆ›å»ºä¸€ä¸ªAIDLæŽ¥å£ï¼ŒæŽ¥å£ä¸­æä¾›å‘é€æ¶ˆæ¯çš„æ–¹æ³•ï¼ˆAndroid Studioåˆ›å»ºAIDLï¼šé¡¹ç›®å³é”® -&gt; New -&gt; AIDL -&gt; AIDL Fileï¼‰ï¼Œä»£ç å¦‚ä¸‹ï¼š123456package com.example.aidl;import com.example.aidl.data.MessageModel;interface MessageSender &#123; void sendMessage(in MessageModel messageModel);&#125; ä¸€ä¸ªæ¯”è¾ƒå°´å°¬çš„äº‹æƒ…ï¼Œçœ‹äº†å¾ˆå¤šæ–‡ç« ï¼Œä»Žæ¥æ²¡æœ‰ä¸€ç¯‡èƒ½è¯´æ¸…æ¥šinã€outã€inoutè¿™ä¸‰ä¸ªå‚æ•°æ–¹å‘çš„æ„ä¹‰ï¼ŒåŽæ¥åœ¨stackoverflowä¸Šæ‰¾åˆ°æ¯”è¾ƒèƒ½ç†è§£çš„ç­”æ¡ˆï¼ˆstackoverflowåŽŸæ–‡é“¾æŽ¥ï¼‰ï¼Œæˆ‘ç¿»è¯‘ä¸€ä¸‹å¤§æ¦‚æ„æ€ï¼šè¢«â€œinâ€æ ‡è®°çš„å‚æ•°ï¼Œå°±æ˜¯æŽ¥æ”¶å®žé™…æ•°æ®çš„å‚æ•°ï¼Œè¿™ä¸ªè·Ÿæˆ‘ä»¬æ™®é€šå‚æ•°ä¼ é€’ä¸€æ ·çš„å«ä¹‰ã€‚åœ¨AIDLä¸­ï¼Œâ€œoutâ€ æŒ‡å®šäº†ä¸€ä¸ªä»…ç”¨äºŽè¾“å‡ºçš„å‚æ•°ï¼Œæ¢è€Œè¨€ä¹‹ï¼Œè¿™ä¸ªå‚æ•°ä¸å…³å¿ƒè°ƒç”¨æ–¹ä¼ é€’äº†ä»€ä¹ˆæ•°æ®è¿‡æ¥ï¼Œä½†æ˜¯è¿™ä¸ªå‚æ•°çš„å€¼å¯ä»¥åœ¨æ–¹æ³•è¢«è°ƒç”¨åŽå¡«å……ï¼ˆæ— è®ºè°ƒç”¨æ–¹ä¼ é€’äº†ä»€ä¹ˆå€¼è¿‡æ¥ï¼Œåœ¨æ–¹æ³•æ‰§è¡Œçš„æ—¶å€™ï¼Œè¿™ä¸ªå‚æ•°çš„åˆå§‹å€¼æ€»æ˜¯ç©ºçš„ï¼‰ï¼Œè¿™å°±æ˜¯â€œoutâ€çš„å«ä¹‰ï¼Œä»…ç”¨äºŽè¾“å‡ºã€‚è€Œâ€œinoutâ€æ˜¾ç„¶å°±æ˜¯â€œinâ€å’Œâ€œoutâ€çš„åˆä½“äº†ï¼Œè¾“å…¥å’Œè¾“å‡ºçš„å‚æ•°ã€‚åŒºåˆ†â€œinâ€ã€â€œoutâ€æœ‰ä»€ä¹ˆç”¨ï¼Ÿè¿™æ˜¯éžå¸¸é‡è¦çš„ï¼Œå› ä¸ºæ¯ä¸ªå‚æ•°çš„å†…å®¹å¿…é¡»ç¼–ç»„ï¼ˆåºåˆ—åŒ–ï¼Œä¼ è¾“ï¼ŒæŽ¥æ”¶å’Œååºåˆ—åŒ–ï¼‰ã€‚in/outæ ‡ç­¾å…è®¸Binderè·³è¿‡ç¼–ç»„æ­¥éª¤ä»¥èŽ·å¾—æ›´å¥½çš„æ€§èƒ½ã€‚ ä¸Šè¿°çš„MessageModelä¸ºæ¶ˆæ¯çš„å®žä½“ç±»ï¼Œè¯¥ç±»åœ¨AIDLä¸­ä¼ é€’ï¼Œå®žçŽ°äº†Parcelableåºåˆ—åŒ–æŽ¥å£ï¼Œä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516171819public class MessageModel implements Parcelable &#123; private String from; private String to; private String content; ... Setter &amp; Getter ... @Override public int describeContents() &#123; return 0; &#125; //... åºåˆ—åŒ–ç›¸å…³ä»£ç  //...&#125; æ‰‹åŠ¨å®žçŽ°ParcelableæŽ¥å£æ¯”è¾ƒéº»çƒ¦ï¼Œå®‰åˆ©ä¸€æ¬¾ASè‡ªåŠ¨ç”Ÿæˆæ’ä»¶android-parcelable-intellij-pluginåˆ›å»ºå®ŒMessageModelè¿™ä¸ªå®žä½“ç±»ï¼Œåˆ«å¿˜äº†è¿˜æœ‰ä¸€ä»¶äº‹è¦åšï¼šâ€åœ¨AIDLä¸­ä¼ é€’çš„å¯¹è±¡ï¼Œéœ€è¦åœ¨ç±»æ–‡ä»¶ç›¸åŒè·¯å¾„ä¸‹ï¼Œåˆ›å»ºåŒåã€ä½†æ˜¯åŽç¼€ä¸º.aidlçš„æ–‡ä»¶ï¼Œå¹¶åœ¨æ–‡ä»¶ä¸­ä½¿ç”¨parcelableå…³é”®å­—å£°æ˜Žè¿™ä¸ªç±»â€œã€‚ä»£ç å¦‚ä¸‹ï¼š 123package com.example.aidl.data;parcelable MessageModel; å¯¹äºŽæ²¡æœ‰æŽ¥è§¦è¿‡aidlçš„åŒå­¦ï¼Œå…‰è¯´å°±èƒ½è®©äººæ‡µé€¼ï¼Œæ¥çœ‹çœ‹æ­¤æ—¶çš„é¡¹ç›®ç»“æž„åŽ‹åŽ‹æƒŠï¼šæˆ‘ä»¬åˆšåˆšæ–°å¢žçš„3ä¸ªæ–‡ä»¶ï¼š MessageSender.aidl -&gt; å®šä¹‰äº†å‘é€æ¶ˆæ¯çš„æ–¹æ³•ï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆåä¸ºMessageSender.Stubçš„Binderç±»ï¼Œåœ¨æœåŠ¡ç«¯å®žçŽ°ï¼Œè¿”å›žç»™å®¢æˆ·ç«¯è°ƒç”¨ MessageModel.java -&gt; æ¶ˆæ¯å®žä½“ç±»ï¼Œç”±å®¢æˆ·ç«¯ä¼ é€’åˆ°æœåŠ¡ç«¯ï¼Œå®žçŽ°äº†Parcelableåºåˆ—åŒ– MessageModel.aidl -&gt; å£°æ˜Žäº†MessageModelå¯åœ¨AIDLä¸­ä¼ é€’ï¼Œæ”¾åœ¨è·ŸMessageModel.javaç›¸åŒçš„åŒ…è·¯å¾„ä¸‹ OKï¼Œç›¸ä¿¡æ­¤æ—¶æ‡µé€¼å·²è§£é™¤~ 2.5 åœ¨æœåŠ¡ç«¯åˆ›å»ºMessageSender.aidlè¿™ä¸ªAIDLæŽ¥å£è‡ªåŠ¨ç”Ÿæˆçš„Binderå¯¹è±¡ï¼Œå¹¶è¿”å›žç»™å®¢æˆ·ç«¯è°ƒç”¨ï¼ŒæœåŠ¡ç«¯MessageServiceä»£ç å¦‚ä¸‹ï¼š123456789101112131415161718192021public class MessageService extends Service &#123; private static final String TAG = "MessageService"; public MessageService() &#123; &#125; IBinder messageSender = new MessageSender.Stub() &#123; @Override public void sendMessage(MessageModel messageModel) throws RemoteException &#123; Log.d(TAG, "messageModel: " + messageModel.toString()); &#125; &#125;; @Override public IBinder onBind(Intent intent) &#123; return messageSender; &#125;&#125; MessageSender.Stubæ˜¯Android Studioæ ¹æ®æˆ‘ä»¬MessageSender.aidlæ–‡ä»¶è‡ªåŠ¨ç”Ÿæˆçš„Binderå¯¹è±¡ï¼ˆè‡³äºŽæ˜¯æ€Žæ ·ç”Ÿæˆçš„ï¼Œä¸‹æ–‡ä¼šæœ‰ç­”æ¡ˆï¼‰ï¼Œæˆ‘ä»¬éœ€è¦æŠŠè¿™ä¸ªBinderå¯¹è±¡è¿”å›žç»™å®¢æˆ·ç«¯ã€‚ 2.6 å®¢æˆ·ç«¯æ‹¿åˆ°Binderå¯¹è±¡åŽè°ƒç”¨è¿œç¨‹æ–¹æ³•è°ƒç”¨æ­¥éª¤å¦‚ä¸‹ï¼š åœ¨å®¢æˆ·ç«¯çš„onServiceConnectedæ–¹æ³•ä¸­ï¼Œæ‹¿åˆ°æœåŠ¡ç«¯è¿”å›žçš„Binderå¯¹è±¡ï¼› ä½¿ç”¨MessageSender.Stub.asInterfaceæ–¹æ³•ï¼Œå–å¾—MessageSender.aidlå¯¹åº”çš„æ“ä½œæŽ¥å£ï¼› å–å¾—MessageSenderå¯¹è±¡åŽï¼Œåƒæ™®é€šæŽ¥å£ä¸€æ ·è°ƒç”¨æ–¹æ³•å³å¯ã€‚ æ­¤æ—¶å®¢æˆ·ç«¯ä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546public class MainActivity extends AppCompatActivity &#123; private MessageSender messageSender; @Override protected void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); setContentView(R.layout.activity_main); setupService(); &#125; //... private void setupService() &#123; Intent intent = new Intent(this, MessageService.class); bindService(intent, serviceConnection, Context.BIND_AUTO_CREATE); startService(intent); &#125; ServiceConnection serviceConnection = new ServiceConnection() &#123; @Override public void onServiceConnected(ComponentName name, IBinder service) &#123; //ä½¿ç”¨asInterfaceæ–¹æ³•å–å¾—AIDLå¯¹åº”çš„æ“ä½œæŽ¥å£ messageSender = MessageSender.Stub.asInterface(service); //ç”Ÿæˆæ¶ˆæ¯å®žä½“å¯¹è±¡ MessageModel messageModel = new MessageModel(); messageModel.setFrom("client user id"); messageModel.setTo("receiver user id"); messageModel.setContent("This is message content"); //è°ƒç”¨è¿œç¨‹Serviceçš„sendMessageæ–¹æ³•ï¼Œå¹¶ä¼ é€’æ¶ˆæ¯å®žä½“å¯¹è±¡ try &#123; messageSender.sendMessage(messageModel); &#125; catch (RemoteException e) &#123; e.printStackTrace(); &#125; &#125; @Override public void onServiceDisconnected(ComponentName name) &#123; &#125; &#125;;&#125; åœ¨å®¢æˆ·ç«¯ä¸­æˆ‘ä»¬è°ƒç”¨äº†MessageSenderçš„sendMessageæ–¹æ³•ï¼Œå‘æœåŠ¡ç«¯å‘é€äº†ä¸€æ¡æ¶ˆæ¯ï¼Œå¹¶æŠŠç”Ÿæˆçš„MessageModelå¯¹è±¡ä½œä¸ºå‚æ•°ä¼ é€’åˆ°äº†æœåŠ¡ç«¯ï¼Œæœ€ç»ˆæœåŠ¡ç«¯æ‰“å°çš„ç»“æžœå¦‚ä¸‹ï¼š è¿™é‡Œæœ‰ä¸¤ç‚¹è¦è¯´ï¼š æœåŠ¡ç«¯å·²ç»æŽ¥æ”¶åˆ°å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„æ¶ˆæ¯ï¼Œå¹¶æ­£ç¡®æ‰“å°ï¼› æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯åŒºåˆ†ä¸¤ä¸ªè¿›ç¨‹ï¼ŒPIDä¸ä¸€æ ·ï¼Œè¿›ç¨‹åä¹Ÿä¸ä¸€æ ·ï¼› åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å·²ç»å®Œæˆäº†æœ€åŸºæœ¬çš„ä½¿ç”¨AIDLè¿›è¡Œè·¨è¿›ç¨‹æ–¹æ³•è°ƒç”¨ï¼Œä¹Ÿæ˜¯Step.0çš„æ•´ä¸ªç»†åŒ–è¿‡ç¨‹ï¼Œå¯ä»¥å†å›žé¡¾ä¸€ä¸‹Step.0ï¼Œæ—¢ç„¶å·²ç»å­¦ä¼šä½¿ç”¨äº†ï¼ŒæŽ¥ä¸‹æ¥â€¦å…¨å‰§ç»ˆã€‚ã€‚ã€‚ å¦‚æžœå†™åˆ°è¿™é‡Œå…¨å‰§ç»ˆï¼Œé‚£è·Ÿå’¸é±¼æœ‰ä»€ä¹ˆåŒºåˆ«â€¦ çŸ¥å…¶ç„¶ï¼ŒçŸ¥å…¶æ‰€ä»¥ç„¶ã€‚æˆ‘ä»¬é€šè¿‡ä¸Šè¿°çš„è°ƒç”¨æµç¨‹ï¼Œçœ‹çœ‹ä»Žå®¢æˆ·ç«¯åˆ°æœåŠ¡ç«¯ï¼Œéƒ½ç»åŽ†äº†äº›ä»€ä¹ˆäº‹ï¼Œçœ‹çœ‹Binderçš„ä¸Šå±‚æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œè‡³äºŽBinderçš„åº•å±‚ï¼Œè¿™æ˜¯ä¸€ä¸ªéžå¸¸å¤æ‚çš„è¯é¢˜ï¼Œæœ¬æ–‡ä¸æ·±ç©¶ã€‚ï¼ˆå¦‚æžœçœ‹åˆ°è¿™é‡Œä½ åˆæƒ³é—®ä»€ä¹ˆæ˜¯Binderçš„è¯ï¼Œè¯·æ‰‹åŠ¨å€’å¸¦å¾€ä¸Šçœ‹â€¦ï¼‰ æˆ‘ä»¬å…ˆæ¥å›žé¡¾ä¸€ä¸‹ä»Žå®¢æˆ·ç«¯å‘èµ·çš„è°ƒç”¨æµç¨‹ï¼š MessageSender messageSender = MessageSender.Stub.asInterface(service); messageSender.sendMessage(messageModel); æŠ›å¼€å…¶å®ƒæ— å…³ä»£ç ï¼Œå®¢æˆ·ç«¯è°ƒè·¨è¿›ç¨‹æ–¹æ³•å°±è¿™ä¸¤ä¸ªæ­¥éª¤ï¼Œè€Œè¿™ä¸¤ä¸ªæ­¥éª¤éƒ½å°è£…åœ¨ MessageSender.aidl æœ€ç»ˆç”Ÿæˆçš„ MessageSender.java æºç ï¼ˆå…·ä½“è·¯å¾„ä¸ºï¼šbuildç›®å½•ä¸‹æŸä¸ªå­ç›®å½•ï¼Œè‡ªå·±æ‰¾ï¼Œä¸çˆ½ä½ æ¥æ‰“æˆ‘å•Š ðŸ˜‹ ï¼‰ è¯·çœ‹ä¸‹æ–¹ä»£ç å’Œæ³¨é‡Šï¼Œå‰æ–¹é«˜èƒ½é¢„è­¦â€¦ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990public interface MessageSender extends android.os.IInterface &#123; public static abstract class Stub extends android.os.Binder implements com.example.aidl.MessageSender &#123; private static final java.lang.String DESCRIPTOR = "com.example.aidl.MessageSender"; /** * æŠŠIBinderå¯¹è±¡è½¬æ¢ä¸º com.example.aidl.MessageSender æŽ¥å£ * åˆ¤æ–­IBinderæ˜¯å¦å¤„äºŽç›¸åŒè¿›ç¨‹ï¼Œç›¸åŒè¿›ç¨‹è¿”å›žStubå®žçŽ°çš„com.example.aidl.MessageSenderæŽ¥å£ * ä¸åŒè¿›ç¨‹ï¼Œåˆ™è¿”å›žStub.Proxyå®žçŽ°çš„com.example.aidl.MessageSenderæŽ¥å£ */ public static com.example.aidl.MessageSender asInterface(android.os.IBinder obj) &#123; if ((obj == null)) &#123; return null; &#125; android.os.IInterface iin = obj.queryLocalInterface(DESCRIPTOR); if (((iin != null) &amp;&amp; (iin instanceof com.example.aidl.MessageSender))) &#123; return ((com.example.aidl.MessageSender) iin); &#125; return new com.example.aidl.MessageSender.Stub.Proxy(obj); &#125; /** * åŒä¸€è¿›ç¨‹æ—¶ï¼Œä¸ä¼šè§¦å‘ * * ä¸åŒè¿›ç¨‹æ—¶ï¼ŒasInterfaceä¼šè¿”å›žStub.Proxyï¼Œå®¢æˆ·ç«¯è°ƒç”¨ messageSender.sendMessage(messageModel) * å®žè´¨æ˜¯è°ƒç”¨äº† Stub.Proxy çš„ sendMessage æ–¹æ³•ï¼Œä»Žè€Œè§¦å‘è·¨è¿›ç¨‹æ•°æ®ä¼ é€’ï¼Œ * æœ€ç»ˆBinderåº•å±‚å°†å¤„ç†å¥½çš„æ•°æ®å›žè°ƒåˆ°æ­¤æ–¹æ³•ï¼Œå¹¶è°ƒç”¨æˆ‘ä»¬çœŸæ­£çš„sendMessageæ–¹æ³• */ @Override public boolean onTransact(int code, android.os.Parcel data, android.os.Parcel reply, int flags) throws android.os.RemoteException &#123; switch (code) &#123; case INTERFACE_TRANSACTION: &#123; reply.writeString(DESCRIPTOR); return true; &#125; case TRANSACTION_sendMessage: &#123; data.enforceInterface(DESCRIPTOR); com.example.aidl.data.MessageModel _arg0; if ((0 != data.readInt())) &#123; _arg0 = com.example.aidl.data.MessageModel.CREATOR.createFromParcel(data); &#125; else &#123; _arg0 = null; &#125; this.sendMessage(_arg0); reply.writeNoException(); return true; &#125; &#125; return super.onTransact(code, data, reply, flags); &#125; private static class Proxy implements com.example.aidl.MessageSender &#123; private android.os.IBinder mRemote; Proxy(android.os.IBinder remote) &#123; mRemote = remote; &#125; /** * Proxyä¸­çš„sendMessageæ–¹æ³•ï¼Œå¹¶ä¸æ˜¯ç›´æŽ¥è°ƒç”¨æˆ‘ä»¬å®šä¹‰çš„sendMessageæ–¹æ³•ï¼Œè€Œæ˜¯ç»è¿‡ä¸€é¡¿çš„Parcelè¯»å†™ï¼Œ * ç„¶åŽè°ƒç”¨mRemote.transactæ–¹æ³•ï¼ŒæŠŠæ•°æ®äº¤ç»™Binderå¤„ç†ï¼Œtransactå¤„ç†å®Œæ¯•åŽä¼šè°ƒç”¨ä¸Šæ–¹çš„onTransactæ–¹æ³•ï¼Œ * onTransactæ‹¿åˆ°æœ€ç»ˆå¾—åˆ°çš„å‚æ•°æ•°æ®ï¼Œè°ƒç”¨ç”±æˆ‘ä»¬çœŸæ­£çš„sendMessageæ–¹æ³• */ @Override public void sendMessage(com.example.aidl.data.MessageModel messageModel) throws android.os.RemoteException &#123; android.os.Parcel _data = android.os.Parcel.obtain(); android.os.Parcel _reply = android.os.Parcel.obtain(); try &#123; _data.writeInterfaceToken(DESCRIPTOR); if ((messageModel != null)) &#123; _data.writeInt(1); messageModel.writeToParcel(_data, 0); &#125; else &#123; _data.writeInt(0); &#125; //è°ƒç”¨Binderçš„transactæ–¹æ³•è¿›è¡Œå¤šè¿›ç¨‹æ•°æ®ä¼ è¾“ï¼Œå¤„ç†å®Œæ¯•åŽè°ƒç”¨ä¸Šæ–¹çš„onTransactæ–¹æ³• mRemote.transact(Stub.TRANSACTION_sendMessage, _data, _reply, 0); _reply.readException(); &#125; finally &#123; _reply.recycle(); _data.recycle(); &#125; &#125; &#125; static final int TRANSACTION_sendMessage = (android.os.IBinder.FIRST_CALL_TRANSACTION + 0); &#125; public void sendMessage(com.example.aidl.data.MessageModel messageModel) throws android.os.RemoteException;&#125; åªçœ‹ä»£ç çš„è¯ï¼Œå¯èƒ½ä¼šæœ‰ç‚¹æ‡µé€¼ï¼Œç›¸ä¿¡ç»“åˆä»£ç å†çœ‹ä¸‹æ–¹çš„æµç¨‹å›¾ä¼šæ›´å¥½ç†è§£ï¼š ä»Žå®¢æˆ·ç«¯çš„sendMessageå¼€å§‹ï¼Œæ•´ä¸ªAIDLçš„è°ƒç”¨è¿‡ç¨‹å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒasInterfaceæ–¹æ³•ï¼Œå°†ä¼šåˆ¤æ–­onBindæ–¹æ³•è¿”å›žçš„Binderæ˜¯å¦å­˜å¤„äºŽåŒä¸€è¿›ç¨‹ï¼Œåœ¨åŒä¸€è¿›ç¨‹ä¸­ï¼Œåˆ™è¿›è¡Œå¸¸è§„çš„æ–¹æ³•è°ƒç”¨ï¼Œè‹¥å¤„äºŽä¸åŒè¿›ç¨‹ï¼Œæ•´ä¸ªæ•°æ®ä¼ é€’çš„è¿‡ç¨‹åˆ™éœ€è¦é€šè¿‡Binderåº•å±‚åŽ»è¿›è¡Œç¼–ç»„ï¼ˆåºåˆ—åŒ–ï¼Œä¼ è¾“ï¼ŒæŽ¥æ”¶å’Œååºåˆ—åŒ–ï¼‰ï¼Œå¾—åˆ°æœ€ç»ˆçš„æ•°æ®åŽå†è¿›è¡Œå¸¸è§„çš„æ–¹æ³•è°ƒç”¨ã€‚ æ•²é»‘æ¿ï¼šå¯¹è±¡è·¨è¿›ç¨‹ä¼ è¾“çš„æœ¬è´¨å°±æ˜¯ åºåˆ—åŒ–ï¼Œä¼ è¾“ï¼ŒæŽ¥æ”¶å’Œååºåˆ—åŒ– è¿™æ ·ä¸€ä¸ªè¿‡ç¨‹ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆè·¨è¿›ç¨‹ä¼ è¾“çš„å¯¹è±¡å¿…é¡»å®žçŽ°ParcelableæŽ¥å£ è·¨è¿›ç¨‹çš„å›žè°ƒæŽ¥å£åœ¨ä¸Šé¢æˆ‘ä»¬å·²ç»å®žçŽ°äº†ä»Žå®¢æˆ·ç«¯å‘é€æ¶ˆæ¯åˆ°è·¨è¿›ç¨‹æœåŠ¡ç«¯çš„åŠŸèƒ½ï¼ŒæŽ¥ä¸‹æ¥æˆ‘ä»¬è¿˜éœ€è¦å°†æœåŠ¡ç«¯æŽ¥æ”¶åˆ°çš„è¿œç¨‹æœåŠ¡å™¨æ¶ˆæ¯ï¼Œä¼ é€’åˆ°å®¢æˆ·ç«¯ã€‚æœ‰åŒå­¦ä¼°è®¡ä¼šè¯´ï¼šâ€œè¿™ä¸å°±æ˜¯ä¸€ä¸ªå›žè°ƒæŽ¥å£çš„äº‹æƒ…å˜›â€ï¼Œè®¾ç½®å›žè°ƒæŽ¥å£æ€è·¯æ˜¯å¯¹çš„ï¼Œä½†æ˜¯åœ¨è¿™é‡Œä½¿ç”¨çš„å›žè°ƒæŽ¥å£æœ‰ç‚¹ä¸ä¸€æ ·ï¼Œåœ¨AIDLä¸­ä¼ é€’çš„æŽ¥å£ï¼Œä¸èƒ½æ˜¯æ™®é€šçš„æŽ¥å£ï¼Œåªèƒ½æ˜¯AIDLæŽ¥å£ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ–°å»ºä¸€ä¸ªAIDLæŽ¥å£ä¼ åˆ°æœåŠ¡ç«¯ï¼Œä½œä¸ºå›žè°ƒæŽ¥å£ã€‚ æ–°å»ºæ¶ˆæ¯æ”¶å–çš„AIDLæŽ¥å£MessageReceiver.aidlï¼š 123456package com.example.aidl;import com.example.aidl.data.MessageModel;interface MessageReceiver &#123; void onMessageReceived(in MessageModel receivedMessage);&#125; æŽ¥ä¸‹æ¥æˆ‘ä»¬æŠŠå›žè°ƒæŽ¥å£æ³¨å†Œåˆ°æœåŠ¡ç«¯åŽ»ï¼Œä¿®æ”¹æˆ‘ä»¬çš„MessageSender.aidl: 1234567891011package com.example.aidl;import com.example.aidl.data.MessageModel;import com.example.aidl.MessageReceiver;interface MessageSender &#123; void sendMessage(in MessageModel messageModel); void registerReceiveListener(MessageReceiver messageReceiver); void unregisterReceiveListener(MessageReceiver messageReceiver);&#125; ä»¥ä¸Šå°±æ˜¯æˆ‘ä»¬æœ€ç»ˆä¿®æ”¹å¥½çš„aidlæŽ¥å£ï¼ŒæŽ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦åšå‡ºå¯¹åº”çš„å˜æ›´ï¼š åœ¨æœåŠ¡ç«¯ä¸­å¢žåŠ MessageSenderçš„æ³¨å†Œå’Œåæ³¨å†ŒæŽ¥å£çš„æ–¹æ³•ï¼› åœ¨å®¢æˆ·ç«¯ä¸­å®žçŽ°MessageReceiveræŽ¥å£ï¼Œå¹¶é€šè¿‡MessageSenderæ³¨å†Œåˆ°æœåŠ¡ç«¯ã€‚ å®¢æˆ·ç«¯å˜æ›´ï¼Œä¿®æ”¹MainActivityï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960public class MainActivity extends AppCompatActivity &#123; private MessageSender messageSender; @Override protected void onCreate(Bundle savedInstanceState) &#123; //... &#125; /** * 1.unregisterListener * 2.unbindService */ @Override protected void onDestroy() &#123; //è§£é™¤æ¶ˆæ¯ç›‘å¬æŽ¥å£ if (messageSender != null &amp;&amp; messageSender.asBinder().isBinderAlive()) &#123; try &#123; messageSender.unregisterReceiveListener(messageReceiver); &#125; catch (RemoteException e) &#123; e.printStackTrace(); &#125; &#125; unbindService(serviceConnection); super.onDestroy(); &#125; //æ¶ˆæ¯ç›‘å¬å›žè°ƒæŽ¥å£ private MessageReceiver messageReceiver = new MessageReceiver.Stub() &#123; @Override public void onMessageReceived(MessageModel receivedMessage) throws RemoteException &#123; Log.d(TAG, "onMessageReceived: " + receivedMessage.toString()); &#125; &#125;; ServiceConnection serviceConnection = new ServiceConnection() &#123; @Override public void onServiceConnected(ComponentName name, IBinder service) &#123; //ä½¿ç”¨asInterfaceæ–¹æ³•å–å¾—AIDLå¯¹åº”çš„æ“ä½œæŽ¥å£ messageSender = MessageSender.Stub.asInterface(service); //ç”Ÿæˆæ¶ˆæ¯å®žä½“å¯¹è±¡ MessageModel messageModel = new MessageModel(); //... try &#123; //æŠŠæŽ¥æ”¶æ¶ˆæ¯çš„å›žè°ƒæŽ¥å£æ³¨å†Œåˆ°æœåŠ¡ç«¯ messageSender.registerReceiveListener(messageReceiver); //è°ƒç”¨è¿œç¨‹Serviceçš„sendMessageæ–¹æ³•ï¼Œå¹¶ä¼ é€’æ¶ˆæ¯å®žä½“å¯¹è±¡ messageSender.sendMessage(messageModel); &#125; catch (RemoteException e) &#123; e.printStackTrace(); &#125; &#125; @Override public void onServiceDisconnected(ComponentName name) &#123; &#125; &#125;;&#125; å®¢æˆ·ç«¯ä¸»è¦æœ‰3ä¸ªå˜æ›´ï¼š å¢žåŠ äº†messageReceiverå¯¹è±¡ï¼Œç”¨äºŽç›‘å¬æœåŠ¡ç«¯çš„æ¶ˆæ¯é€šçŸ¥ï¼› onServiceConnectedæ–¹æ³•ä¸­ï¼ŒæŠŠmessageReceiveræ³¨å†Œåˆ°Serviceä¸­åŽ»ï¼› onDestroyæ—¶å€™è§£é™¤messageReceiverçš„æ³¨å†Œã€‚ ä¸‹é¢å¯¹æœåŠ¡ç«¯MessageServieè¿›è¡Œå˜æ›´ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283public class MessageService extends Service &#123; private static final String TAG = "MessageService"; private AtomicBoolean serviceStop = new AtomicBoolean(false); //RemoteCallbackListä¸“é—¨ç”¨æ¥ç®¡ç†å¤šè¿›ç¨‹å›žè°ƒæŽ¥å£ private RemoteCallbackList&lt;MessageReceiver&gt; listenerList = new RemoteCallbackList&lt;&gt;(); public MessageService() &#123; &#125; IBinder messageSender = new MessageSender.Stub() &#123; @Override public void sendMessage(MessageModel messageModel) throws RemoteException &#123; Log.e(TAG, "messageModel: " + messageModel.toString()); &#125; @Override public void registerReceiveListener(MessageReceiver messageReceiver) throws RemoteException &#123; listenerList.register(messageReceiver); &#125; @Override public void unregisterReceiveListener(MessageReceiver messageReceiver) throws RemoteException &#123; listenerList.unregister(messageReceiver); &#125; &#125;; @Override public IBinder onBind(Intent intent) &#123; return messageSender; &#125; @Override public void onCreate() &#123; super.onCreate(); new Thread(new FakeTCPTask()).start(); &#125; @Override public void onDestroy() &#123; serviceStop.set(true); super.onDestroy(); &#125; //æ¨¡æ‹Ÿé•¿è¿žæŽ¥ï¼Œé€šçŸ¥å®¢æˆ·ç«¯æœ‰æ–°æ¶ˆæ¯åˆ°è¾¾ private class FakeTCPTask implements Runnable &#123; @Override public void run() &#123; while (!serviceStop.get()) &#123; try &#123; Thread.sleep(5000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; MessageModel messageModel = new MessageModel(); messageModel.setFrom("Service"); messageModel.setTo("Client"); messageModel.setContent(String.valueOf(System.currentTimeMillis())); /** * RemoteCallbackListçš„éåŽ†æ–¹å¼ * beginBroadcastå’ŒfinishBroadcastä¸€å®šè¦é…å¯¹ä½¿ç”¨ */ final int listenerCount = listenerList.beginBroadcast(); Log.d(TAG, "listenerCount == " + listenerCount); for (int i = 0; i &lt; listenerCount; i++) &#123; MessageReceiver messageReceiver = listenerList.getBroadcastItem(i); if (messageReceiver != null) &#123; try &#123; messageReceiver.onMessageReceived(messageModel); &#125; catch (RemoteException e) &#123; e.printStackTrace(); &#125; &#125; &#125; listenerList.finishBroadcast(); &#125; &#125; &#125;&#125; æœåŠ¡ç«¯ä¸»è¦å˜æ›´ï¼š MessageSender.Stubå®žçŽ°äº†æ³¨å†Œå’Œåæ³¨å†Œå›žè°ƒæŽ¥å£çš„æ–¹æ³•ï¼› å¢žåŠ äº†RemoteCallbackListæ¥ç®¡ç†AIDLè¿œç¨‹æŽ¥å£ï¼› FakeTCPTaskæ¨¡æ‹Ÿäº†é•¿è¿žæŽ¥é€šçŸ¥å®¢æˆ·ç«¯æœ‰æ–°æ¶ˆæ¯åˆ°è¾¾ã€‚ï¼ˆè¿™é‡Œçš„é•¿è¿žæŽ¥å¯ä»¥æ˜¯XMPPï¼ŒMinaï¼ŒMarsï¼ŒNettyç­‰ï¼Œè¿™é‡Œå¼„ä¸ªå‡çš„æ„æ€æ„æ€ï¼Œæœ‰æ—¶é—´çš„è¯å’±å¼€ä¸ªå¸–å­èŠèŠXMPPï¼‰ è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªéœ€è¦è®²ä¸€ä¸‹çš„ï¼Œå°±æ˜¯RemoteCallbackListï¼Œä¸ºä»€ä¹ˆè¦ç”¨RemoteCallbackListï¼Œæ™®é€šArrayListä¸è¡Œå—ï¼Ÿå½“ç„¶ä¸è¡Œï¼Œä¸ç„¶å¹²å˜›åˆæ•´ä¸€ä¸ªRemoteCallbackList ðŸ™ƒï¼ŒregisterReceiveListener å’Œ unregisterReceiveListeneråœ¨å®¢æˆ·ç«¯ä¼ è¾“è¿‡æ¥çš„å¯¹è±¡ï¼Œç»è¿‡Binderå¤„ç†ï¼Œåœ¨æœåŠ¡ç«¯æŽ¥æ”¶åˆ°çš„æ—¶å€™å…¶å®žæ˜¯ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œè¿™æ ·å¯¼è‡´åœ¨ unregisterReceiveListener çš„æ—¶å€™ï¼Œæ™®é€šçš„ArrayListæ˜¯æ— æ³•æ‰¾åˆ°åœ¨ registerReceiveListener æ—¶å€™æ·»åŠ åˆ°Listçš„é‚£ä¸ªå¯¹è±¡çš„ï¼Œä½†æ˜¯å®ƒä»¬åº•å±‚ä½¿ç”¨çš„Binderå¯¹è±¡æ˜¯åŒä¸€ä¸ªï¼ŒRemoteCallbackListåˆ©ç”¨è¿™ä¸ªç‰¹æ€§åšåˆ°äº†å¯ä»¥æ‰¾åˆ°åŒä¸€ä¸ªå¯¹è±¡ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é¡ºåˆ©åæ³¨å†Œå®¢æˆ·ç«¯ä¼ é€’è¿‡æ¥çš„æŽ¥å£å¯¹è±¡äº†ã€‚RemoteCallbackListåœ¨å®¢æˆ·ç«¯è¿›ç¨‹ç»ˆæ­¢åŽï¼Œå®ƒèƒ½è‡ªåŠ¨ç§»é™¤å®¢æˆ·ç«¯æ‰€æ³¨å†Œçš„listenerï¼Œå®ƒå†…éƒ¨è¿˜å®žçŽ°äº†çº¿ç¨‹åŒæ­¥ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨æ³¨å†Œå’Œåæ³¨å†Œéƒ½ä¸éœ€è¦è€ƒè™‘çº¿ç¨‹åŒæ­¥ï¼Œçš„ç¡®æ˜¯ä¸ª666çš„ç±»ã€‚ï¼ˆè‡³äºŽä½¿ç”¨ArrayListçš„å¹ºè›¾å­çŽ°è±¡ï¼Œå¤§å®¶å¯ä»¥è‡ªå·±è¯•è¯•ï¼Œç¯‡å¹…é—®é¢˜ï¼Œè¿™é‡Œå°±ä¸æ¼”ç¤ºäº†ï¼‰ åˆ°æ­¤ï¼ŒæœåŠ¡ç«¯é€šçŸ¥å®¢æˆ·ç«¯ç›¸å…³çš„ä»£ç ä¹Ÿå†™å®Œäº†ï¼Œè¿è¡Œç»“æžœæ— éžå°±æ˜¯æ­£ç¡®æ‰“å°ðŸ™ƒå°±ä¸è´´å›¾äº†ï¼Œå¯ä»¥è‡ªå·±Runä¸€ä¸‹ï¼Œæ‰“å°çš„æ—¶å€™æ³¨æ„åŽ»é€‰æ‹©ä¸åŒçš„è¿›ç¨‹ï¼Œä¸ç„¶çžªåå±å¹•ä¹Ÿæ²¡æœ‰æ—¥å¿—ã€‚ DeathRecipientä½ ä»¥ä¸ºè¿™æ ·å°±å®Œäº†ï¼Ÿtoo young too simpleâ€¦ ä¸çŸ¥é“ä½ æœ‰æ²¡æœ‰æ„Ÿè§‰åˆ°ï¼Œä¸¤ä¸ªè¿›ç¨‹äº¤äº’æ€»æ˜¯è§‰å¾—ç¼ºä¹é‚£ä¹ˆä¸€ç‚¹å®‰å…¨æ„Ÿâ€¦æ¯”å¦‚è¯´æœåŠ¡ç«¯è¿›ç¨‹Crashäº†ï¼Œè€Œå®¢æˆ·ç«¯è¿›ç¨‹æƒ³è¦è°ƒç”¨æœåŠ¡ç«¯æ–¹æ³•ï¼Œè¿™æ ·å°±è°ƒç”¨ä¸åˆ°äº†ã€‚æ­¤æ—¶æˆ‘ä»¬å¯ä»¥ç»™Binderè®¾ç½®ä¸€ä¸ªDeathRecipientå¯¹è±¡ï¼Œå½“Binderæ„å¤–æŒ‚äº†çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨DeathRecipientæŽ¥å£çš„å›žè°ƒæ–¹æ³•ä¸­æ”¶åˆ°é€šçŸ¥ï¼Œå¹¶ä½œå‡ºç›¸åº”çš„æ“ä½œï¼Œæ¯”å¦‚é‡è¿žæœåŠ¡ç­‰ç­‰ã€‚ DeathRecipientçš„ä½¿ç”¨å¦‚ä¸‹ï¼š å£°æ˜ŽDeathRecipientå¯¹è±¡ï¼Œå®žçŽ°å…¶binderDiedæ–¹æ³•ï¼Œå½“binderæ­»äº¡æ—¶ï¼Œä¼šå›žè°ƒbinderDiedæ–¹æ³•ï¼› ç»™Binderå¯¹è±¡è®¾ç½®DeathRecipientå¯¹è±¡ã€‚ åœ¨å®¢æˆ·ç«¯MainActivityå£°æ˜ŽDeathRecipientï¼š 12345678910111213141516171819202122232425262728293031/** * Binderå¯èƒ½ä¼šæ„å¤–æ­»å¿™ï¼ˆæ¯”å¦‚Service Crashï¼‰ï¼ŒClientç›‘å¬åˆ°Binderæ­»å¿™åŽå¯ä»¥è¿›è¡Œé‡è¿žæœåŠ¡ç­‰æ“ä½œ */ IBinder.DeathRecipient deathRecipient = new IBinder.DeathRecipient() &#123; @Override public void binderDied() &#123; Log.d(TAG, "binderDied"); if (messageSender != null) &#123; messageSender.asBinder().unlinkToDeath(this, 0); messageSender = null; &#125; //// TODO: 2017/2/28 é‡è¿žæœåŠ¡æˆ–å…¶ä»–æ“ä½œ setupService(); &#125; &#125;; ServiceConnection serviceConnection = new ServiceConnection() &#123; @Override public void onServiceConnected(ComponentName name, IBinder service) &#123; //... try &#123; //è®¾ç½®Binderæ­»äº¡ç›‘å¬ messageSender.asBinder().linkToDeath(deathRecipient, 0); &#125; catch (RemoteException e) &#123; e.printStackTrace(); &#125; &#125; //... &#125;; Binderä¸­ä¸¤ä¸ªé‡è¦æ–¹æ³•ï¼š linkToDeath -&gt; è®¾ç½®æ­»äº¡ä»£ç† DeathRecipient å¯¹è±¡ï¼› unlinkToDeath -&gt; Binderæ­»äº¡çš„æƒ…å†µä¸‹ï¼Œè§£é™¤è¯¥ä»£ç†ã€‚ æ­¤å¤–ï¼ŒBinderä¸­çš„isBinderAliveä¹Ÿå¯ä»¥åˆ¤æ–­Binderæ˜¯å¦æ­»äº¡ã€‚ æƒé™éªŒè¯å°±ç®—æ˜¯å…¬äº¤è½¦ï¼Œä¸Šè½¦ä¹Ÿå¾—å˜€å¡å¯¹ä¸ï¼Œå¦‚æžœå¸Œæœ›æˆ‘ä»¬çš„æœåŠ¡è¿›ç¨‹ä¸æƒ³åƒå…¬äº¤è½¦ä¸€æ ·è°æƒ³ä¸Šå°±ä¸Šï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥åŠ å…¥æƒé™éªŒè¯ã€‚ ä»‹ç»ä¸¤ç§å¸¸ç”¨éªŒè¯æ–¹æ³•ï¼š åœ¨æœåŠ¡ç«¯çš„onBindä¸­æ ¡éªŒè‡ªå®šä¹‰permissionï¼Œå¦‚æžœé€šè¿‡äº†æˆ‘ä»¬çš„æ ¡éªŒï¼Œæ­£å¸¸è¿”å›žBinderå¯¹è±¡ï¼Œæ ¡éªŒä¸é€šè¿‡è¿”å›žnullï¼Œè¿”å›žnullçš„æƒ…å†µä¸‹å®¢æˆ·ç«¯æ— æ³•ç»‘å®šåˆ°æˆ‘ä»¬çš„æœåŠ¡ï¼› åœ¨æœåŠ¡ç«¯çš„onTransactæ–¹æ³•æ ¡éªŒå®¢æˆ·ç«¯åŒ…åï¼Œä¸é€šè¿‡æ ¡éªŒç›´æŽ¥return falseï¼Œæ ¡éªŒé€šè¿‡æ‰§è¡Œæ­£å¸¸çš„æµç¨‹ã€‚ è‡ªå®šä¹‰permissionï¼Œåœ¨Androidmanifest.xmlä¸­å¢žåŠ è‡ªå®šä¹‰çš„æƒé™ï¼š 12345&lt;permission android:name="com.example.aidl.permission.REMOTE_SERVICE_PERMISSION" android:protectionLevel="normal" /&gt;&lt;uses-permission android:name="com.example.aidl.permission.REMOTE_SERVICE_PERMISSION" /&gt; æœåŠ¡ç«¯æ£€æŸ¥æƒé™çš„æ–¹æ³•ï¼š 12345678910111213141516171819202122232425262728293031IBinder messageSender = new MessageSender.Stub() &#123; //... @Override public boolean onTransact(int code, Parcel data, Parcel reply, int flags) throws RemoteException &#123; /** * åŒ…åéªŒè¯æ–¹å¼ */ String packageName = null; String[] packages = getPackageManager().getPackagesForUid(getCallingUid()); if (packages != null &amp;&amp; packages.length &gt; 0) &#123; packageName = packages[0]; &#125; if (packageName == null || !packageName.startsWith("com.example.aidl")) &#123; Log.d("onTransact", "æ‹’ç»è°ƒç”¨ï¼š" + packageName); return false; &#125; return super.onTransact(code, data, reply, flags); &#125;&#125;;@Overridepublic IBinder onBind(Intent intent) &#123; //è‡ªå®šä¹‰permissionæ–¹å¼æ£€æŸ¥æƒé™ if (checkCallingOrSelfPermission("com.example.aidl.permission.REMOTE_SERVICE_PERMISSION") == PackageManager.PERMISSION_DENIED) &#123; return null; &#125; return messageSender;&#125; æ ¹æ®ä¸åŒè¿›ç¨‹ï¼Œåšä¸åŒçš„åˆå§‹åŒ–å·¥ä½œç›¸ä¿¡å‰ä¸€ä¸¤å¹´å¾ˆå¤šæœ‹å‹è¿˜åœ¨ä½¿ç”¨Android-Universal-Image-Loaderæ¥åŠ è½½å›¾ç‰‡ï¼Œå®ƒæ˜¯éœ€è¦åœ¨Applicationç±»è¿›è¡Œåˆå§‹åŒ–çš„ã€‚æ‰“ä¸ªæ¯”å¦‚ï¼Œæˆ‘ä»¬ç”¨å®ƒæ¥åŠ è½½å›¾ç‰‡ï¼Œè€Œä¸”è¿˜æœ‰ä¸€ä¸ªå›¾ç‰‡é€‰æ‹©è¿›ç¨‹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¸Œæœ›åˆ†é…æ›´å¤šçš„ç¼“å­˜ç»™å›¾ç‰‡é€‰æ‹©è¿›ç¨‹ï¼Œåˆæˆ–è€…æ˜¯ä¸€äº›å…¶ä»–çš„åˆå§‹åŒ–å·¥ä½œï¼Œä¸éœ€è¦åœ¨å›¾ç‰‡é€‰æ‹©è¿›ç¨‹åˆå§‹åŒ–æ€Žä¹ˆåŠžï¼Ÿ è¿™é‡Œæä¾›ä¸€ä¸ªç®€å•ç²—æš´çš„æ–¹æ³•ï¼Œåšä¸»ä¹Ÿæ˜¯è¿™ä¹ˆå¹²çš„â€¦ç›´æŽ¥æ‹¿åˆ°è¿›ç¨‹ååˆ¤æ–­ï¼Œä½œå‡ºç›¸åº”æ“ä½œå³å¯ï¼š 123456789101112131415161718192021222324public class MyApp extends Application &#123; @Override public void onCreate() &#123; super.onCreate(); Log.d("process name", getProcessName()); &#125; //å–å¾—è¿›ç¨‹å private String getProcessName() &#123; ActivityManager am = (ActivityManager) getSystemService(Context.ACTIVITY_SERVICE); List&lt;ActivityManager.RunningAppProcessInfo&gt; runningApps = am.getRunningAppProcesses(); if (runningApps == null) &#123; return null; &#125; for (ActivityManager.RunningAppProcessInfo procInfo : runningApps) &#123; if (procInfo.pid == Process.myPid()) &#123; return procInfo.processName; &#125; &#125; return null; &#125;&#125; æ¯ä¸ªè¿›ç¨‹åˆ›å»ºï¼Œéƒ½ä¼šè°ƒç”¨Applicationçš„onCreateæ–¹æ³•ï¼Œè¿™æ˜¯ä¸€ä¸ªéœ€è¦æ³¨æ„çš„åœ°æ–¹ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ ¹æ®å½“å‰è¿›ç¨‹çš„pidï¼Œæ‹¿åˆ°å½“å‰è¿›ç¨‹çš„åå­—åŽ»åšåˆ¤æ–­ï¼Œç„¶åŽåšä¸€äº›æˆ‘ä»¬éœ€è¦çš„é€»è¾‘ï¼Œæˆ‘ä»¬è¿™ä¸ªä¾‹å­ï¼Œæ‹¿åˆ°çš„ä¸¤ä¸ªè¿›ç¨‹ååˆ†åˆ«æ˜¯ï¼š å®¢æˆ·ç«¯è¿›ç¨‹ï¼šcom.example.aidl æœåŠ¡ç«¯è¿›ç¨‹ï¼šcom.example.aidl:remote æ€»ç»“ å¤šè¿›ç¨‹appå¯ä»¥åœ¨ç³»ç»Ÿä¸­ç”³è¯·å¤šä»½å†…å­˜ï¼Œä½†åº”åˆç†ä½¿ç”¨ï¼Œå»ºè®®æŠŠä¸€äº›é«˜æ¶ˆè€—ä½†ä¸å¸¸ç”¨çš„æ¨¡å—æ”¾åˆ°ç‹¬ç«‹çš„è¿›ç¨‹ï¼Œä¸ä½¿ç”¨çš„è¿›ç¨‹å¯åŠæ—¶æ‰‹åŠ¨å…³é—­ï¼› å®žçŽ°å¤šè¿›ç¨‹çš„æ–¹å¼æœ‰å¤šç§ï¼šå››å¤§ç»„ä»¶ä¼ é€’Bundleã€Messengerã€AIDLç­‰ï¼Œé€‰æ‹©é€‚åˆè‡ªå·±çš„ä½¿ç”¨åœºæ™¯ï¼› Androidä¸­å®žçŽ°å¤šè¿›ç¨‹é€šè®¯ï¼Œå»ºè®®ä½¿ç”¨ç³»ç»Ÿæä¾›çš„Binderç±»ï¼Œè¯¥ç±»å·²ç»å®žçŽ°äº†å¤šè¿›ç¨‹é€šè®¯è€Œä¸éœ€è¦æˆ‘ä»¬åšåº•å±‚å·¥ä½œï¼› å¤šè¿›ç¨‹åº”ç”¨ï¼ŒApplicationå°†ä¼šè¢«åˆ›å»ºå¤šæ¬¡ï¼› ç»“è¯­è¿™ç¯‡æ–‡ç« æ–­æ–­ç»­ç»­å†™äº†å¾ˆä¹…ï¼Œè€Œä¸”æˆ‘ç›¸ä¿¡çœŸæ­£ä½¿ç”¨èµ·æ¥çš„åŒå­¦å¯èƒ½ä¸å¤šï¼Œé€‰æ‹©è¿™æ ·ä¸€ä¸ªè¯é¢˜æˆ‘æ˜¯åƒåŠ›ä¸è®¨å¥½â€¦ ä½†æ˜¯æˆ‘è¿˜æ˜¯å¸Œæœ›å¯ä»¥åœ¨è¿™é‡Œæä¾›ä¸€ä¸ªå®Œæ•´çš„è§£å†³æ–¹æ¡ˆç»™å¤§å®¶ã€‚ç®€å•çš„å¤šè¿›ç¨‹ä½¿ç”¨ï¼Œè€Œä¸”æ•ˆæžœæ˜¾è‘—çš„ï¼Œæ¯”å¦‚æŠŠå›¾ç‰‡é€‰æ‹©å’ŒWebViewé…ç½®åˆ°ç‹¬ç«‹çš„è¿›ç¨‹ï¼Œè¿™ä¸ªæˆ‘å¸Œæœ›å¯ä»¥å¤§å®¶è¡ŒåŠ¨èµ·æ¥ã€‚è¿™ç¯‡æ–‡ç« çš„çŸ¥è¯†ç‚¹éžå¸¸å¤šï¼Œç†è§£èµ·æ¥å¯èƒ½ä¸æ˜¯å¤ªå®¹æ˜“ï¼Œå¦‚æžœæœ‰å…´è¶£ï¼Œæˆ‘å»ºè®®ä½ æ‰‹åŠ¨åŽ»å†™ä¸€ä¸‹ï¼Œç„¶åŽä¸ç†è§£çš„åœ°æ–¹ï¼Œæ‰“æ–­ç‚¹çœ‹çœ‹æ˜¯ä»€ä¹ˆæ ·çš„è¿è¡Œæ­¥éª¤ã€‚ å¯¹äºŽé¢è¯•çš„åŒå­¦ï¼Œå¦‚æžœåœ¨é¢è¯•è¿‡ç¨‹ä¸­è¯´åˆ°å¤šè¿›ç¨‹ï¼Œè·Ÿé¢è¯•å®˜èŠå¾—å¼€ï¼Œä¼°è®¡ä¹Ÿæ˜¯èƒ½åŠ ç‚¹åˆ†çš„ï¼Œæˆ–è€…åœ¨å®žé™…å·¥ä½œä¸­ï¼Œä¸€äº›ä½¿ç”¨å¤šè¿›ç¨‹å¯ä»¥æ›´å¥½åœ°è§£å†³é—®é¢˜çš„åœ°æ–¹ï¼Œä½ å¯ä»¥åœ¨ä¼šè®®ä¸­æ‹æ¡ŒçŒ›èµ·ï¼Œè·Ÿä¸»ç®¡è¯´ï¼šâ€œæˆ‘æœ‰ä¸€ä¸ªå¤§èƒ†çš„æƒ³æ³•â€¦â€ï¼Œè¿™æ ·è£…é€¼ä¹Ÿä¸é”™ï¼ˆå½“ç„¶ï¼Œè¢«ç‚’äº†çš„è¯å°±ä¸å…³æˆ‘çš„äº‹äº†â€¦ï¼‰]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>å®žè·µåº”ç”¨</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å¯¹äºŽæœ‰å¤šç§å¯æ›¿ä»£è§£å†³æ–¹æ¡ˆçš„ä¸šåŠ¡é€»è¾‘ï¼Œæä¾›ä¸€ç§å¿«é€Ÿæ›´æ¢çš„æ€è·¯]]></title>
    <url>%2F2016%2F12%2F11%2F%E8%A7%A3%E8%80%A6%E6%80%9D%E8%B7%AF%2F</url>
    <content type="text"><![CDATA[ä»€ä¹ˆæ˜¯â€œæœ‰å¤šç§å¯æ›¿ä»£è§£å†³æ–¹æ¡ˆçš„ä¸šåŠ¡é€»è¾‘â€ï¼Ÿä¸¾å‡ ä¸ªä¾‹å­è¯´æ˜Žï¼š å®¢æˆ·ç«¯çš„httpè¯·æ±‚æ“ä½œï¼Œå¯ä»¥å®žçŽ°çš„æ–¹æ¡ˆæœ‰Retrofitã€OkHttpã€Volleyç­‰ï¼› å®¢æˆ·ç«¯çš„æ•°æ®åº“å­˜å‚¨æ–¹æ¡ˆå¯ä»¥ä¸ºRealmã€greenDaoã€OrmLiteç­‰ï¼› å›¾ç‰‡åŠ è½½çš„æ–¹æ¡ˆå¯ä»¥æ˜¯Frescoã€Glideã€Picassoã€UILç­‰ã€‚ å¦‚ä½•å¿«é€Ÿæ›¿æ¢ï¼Ÿå…ˆæ¥æè¿°ä¸€ä¸‹éœ€æ±‚ï¼Œæ¯”å¦‚è¯´ï¼Œç›®å‰æ­£åœ¨ç”¨çš„httpè¯·æ±‚æ˜¯Volleyï¼ŒçŽ°åœ¨å‘çŽ°ä½¿ç”¨OkHttpæ¥å°è£…ä¸€å¥—ä¼šæ›´å¥½ã€‚åˆæ¯”æ–¹è¯´ï¼Œç›®å‰æ­£åœ¨ç”¨çš„æ•°æ®å­˜å‚¨æ–¹æ¡ˆæ˜¯OrmLiteï¼ŒçŽ°åœ¨ä½¿ç”¨greenDaoæˆ–è€…Realmä¼šæ›´å¥½ï¼Œåœ¨ç±»ä¼¼è¿™äº›æƒ…å†µä¸‹ï¼Œå¦‚ä½•åšåˆ°ä¸ä¿®æ”¹Activity/Fragment/Presenterä»£ç çš„æƒ…å†µä¸‹ï¼ŒæŠŠVolleyçš„httpè¯·æ±‚å®žçŽ°æ›´æ¢æˆOkhttpçš„å®žçŽ°ï¼ŒæŠŠOrmLiteæ›´æ¢æˆgreenDaoæˆ–è€…Realmï¼Ÿ è§£å†³é—®é¢˜çš„å…³é”®è¯ï¼šè®¾è®¡æ¨¡å¼ä¸­çš„â€”â€”å·¥åŽ‚æ–¹æ³•æ¨¡å¼ã€‚æœ¬è´¨ï¼šåˆ©ç”¨æŽ¥å£è¿›è¡Œè§£è€¦ã€‚ è¯´åˆ°è¿™é‡Œï¼Œå¯èƒ½å¾ˆå¤šæœ‰ç»éªŒçš„æœ‹å‹å·²ç»ä¼šå¿ƒä¸€ç¬‘ï¼Œæ˜¯çš„ï¼Œè€å®žè¯´è¿™ç¯‡æ–‡ç« å¯èƒ½å¯¹è€å¸æœºæ²¡æœ‰å¤ªå¤§çš„æ„ä¹‰ï¼Œä½†æ˜¯å¦‚æžœçœ‹åˆ°è¿™é‡Œè¿˜æ˜¯å¿ƒå­˜ç–‘é—®ï¼Œæˆ–è€…ä½ ä¸çŸ¥é“ä»€ä¹ˆæ˜¯å·¥åŽ‚æ–¹æ³•æ¨¡å¼ï¼Œä¹Ÿä¸çŸ¥é“å¦‚ä½•ä½¿ç”¨æŽ¥å£è§£è€¦ä»€ä¹ˆçš„ï¼Œæ²¡å…³ç³»ï¼Œè¯·ç»§ç»­å¾€ä¸‹çœ‹ã€‚ Talk is cheap, show me the code.ä¸‹é¢ï¼Œæˆ‘ä»¬å°±ç”¨Volleyæ›´æ¢åˆ°OkHttpè¿™ä¸ªä¾‹å­æ¥è¯´æ˜Žä¸€ä¸‹å¦‚ä½•åšåˆ°ä¸ä¿®æ”¹Activity/Fragment/Presenterçš„ä»£ç æƒ…å†µä¸‹ï¼Œæ›´å¿«åœ°æ›´æ¢ä¸šåŠ¡é€»è¾‘å®žçŽ°çš„ä»£ç ã€‚ åœ¨å¼€å§‹ä¹‹å‰å…ˆæ¥æ€è€ƒä¸€ä¸‹ä¸Šè¿°æ‰€è¯´â€œå¯æ›¿ä»£è§£å†³æ–¹æ¡ˆâ€çš„å«ä¹‰ï¼Œä¸ºä½•è¿™äº›æ–¹æ¡ˆæ˜¯å¯æ›¿ä»£çš„ï¼Ÿæ˜¯å› ä¸ºå®ƒä»¬å…·æœ‰ç›¸åŒçš„å…±æ€§ï¼Œå®ƒä»¬æ‰€è¦è§£å†³çš„é—®é¢˜æ˜¯ç›¸åŒçš„ï¼Œæ¯”å¦‚è¯´httpè¯·æ±‚æ¡†æž¶ï¼Œæ— è®ºæ˜¯Volley/OkHttp/Retrofitï¼Œå®ƒä»¬æ‰€è¦å®žçŽ°çš„éƒ½æ˜¯httpè¯·æ±‚ä¸­çš„get/post/put/deleteè¿™äº›æ–¹æ³•ï¼Œæ•°æ®åº“å­˜å‚¨æ¡†æž¶ä¸­æ— è®ºæ˜¯Realm/greenDao/OrmLiteï¼Œå®ƒä»¬è¦å®žçŽ°çš„éƒ½æ˜¯å¢žåˆ æ”¹æŸ¥è¿™äº›æ–¹æ³•ã€‚ â€œåšä¸»ä½ åˆ«å†çžŽé€¼é€¼ï¼Œèµ¶ç´§è¯´é‡ç‚¹â€¦â€æˆ‘ï¼šdalaoæˆ‘é”™äº†ï¼Œä¸‹é¢è¯´é‡ç‚¹â€¦ å…ˆæ¥æ¦‚æ‹¬ä¸€ä¸‹æˆ‘ä»¬çš„å®žçŽ°æ€è·¯ï¼š æŠŠhttpè¯·æ±‚æ¡†æž¶çš„å…±æ€§æ–¹æ³•æŠ½å–åˆ°æŽ¥å£ä¸­ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªæŽ¥å£ç§°ä¸ºâ€œè¯·æ±‚æŽ¥å£â€ï¼› åˆ›å»ºä¸€ä¸ªç”¨äºŽè¿”å›žè¯·æ±‚ç»“æžœçš„æŽ¥å£ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªæŽ¥å£ç§°ä¸ºâ€œå›žè°ƒæŽ¥å£â€ï¼› åˆ†åˆ«ç”¨Volleyå’ŒOkHttpå®žçŽ°â€œè¯·æ±‚æŽ¥å£â€ï¼› åˆ›å»ºä¸€ä¸ªç±»æ¥è¿”å›žä¸Šè¿°æŽ¥å£çš„å¯¹è±¡ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªç±»å«åšâ€œå·¥åŽ‚â€ç±»ï¼› åœ¨Activity/Fragment/Presenterä¸­ï¼Œä½¿ç”¨â€œå·¥åŽ‚â€è¿”å›žçš„è¿™ä¸ªæŽ¥å£å¯¹è±¡è°ƒç”¨get/post/put/deleteæ–¹æ³•ï¼Œå¹¶åœ¨â€œå›žè°ƒæŽ¥å£â€ä¸­å¾—åˆ°è¯·æ±‚ç»“æžœã€‚ æœ¬æ–‡å®Œæ•´ä»£ç https://github.com/V1sk/HttpRequestExampleï¼Œå¯ä»¥å…ˆcloneåˆ°æœ¬åœ°å†çœ‹æ–‡ç« ï¼Œä¸ºäº†æ–¹ä¾¿é˜…è¯»ï¼Œä¸‹æ–‡ä¸­çš„ä»£ç å°†çœç•¥éžé‡ç‚¹éƒ¨åˆ†ã€‚ Step1ï¼šæŠŠhttpè¯·æ±‚æ¡†æž¶çš„å…±æ€§æ–¹æ³•æŠ½å–åˆ°æŽ¥å£ä¸­ï¼ˆä¹Ÿå°±æ˜¯ä¸Šè¿°è¯´çš„get/post/put/deleteè¿™äº›æ–¹æ³•ï¼‰1234567891011121314151617/* * æ­¤æŽ¥å£æä¾›çš„å°±æ˜¯httpè¯·æ±‚é€šç”¨çš„æ–¹æ³•ï¼Œè¯¥æŽ¥å£å¯ä»¥ç”¨Volleyæ¥å®žçŽ°ï¼Œä¹Ÿèƒ½ç”¨OkHttpç­‰å…¶å®ƒæ–¹å¼æ¥å®žçŽ° * æŽ¥å£è¯´æ˜Žï¼š * getæ–¹æ³•å‚æ•°åŒ…å«ä¸€ä¸ªurlï¼Œä»¥åŠè¿”å›žæ•°æ®çš„æŽ¥å£ * post/put/deleteæ–¹æ³•è¿˜éœ€è¦æä¾›ä¸€ä¸ªè¯·æ±‚ä½“å‚æ•° */public interface IRequestManager &#123; void get(String url, IRequestCallback requestCallback); void post(String url, String requestBodyJson, IRequestCallback requestCallback); void put(String url, String requestBodyJson, IRequestCallback requestCallback); void delete(String url, String requestBodyJson, IRequestCallback requestCallback);&#125; ä¸Šé¢çš„IRequestManageræŽ¥å£ä¸­ç”¨åˆ°çš„è¯·æ±‚ç»“æžœå›žè°ƒæŽ¥å£â€”â€”IRequestCallback 12345678910111213/** * Created by chenjianwei on 2016/12/11. * è¯·æ±‚è¿”å›žæˆåŠŸ/å¤±è´¥ï¼ŒæˆåŠŸæ—¶ï¼ŒæŠŠæœåŠ¡å™¨è¿”å›žçš„ç»“æžœå›žè°ƒå‡ºåŽ»ï¼Œå¤±è´¥æ—¶å›žè°ƒå¼‚å¸¸ä¿¡æ¯ * onSuccessä¸­çš„å‚æ•°ç±»åž‹ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä¸ºJSONObjectï¼Œè¿™é‡Œåªæ˜¯ä¸¾ä¸ªæ —å­ï¼Œå¯æŒ‰ç…§å®žé™…éœ€æ±‚å˜é€š */public interface IRequestCallback &#123; void onSuccess(String response); void onFailure(Throwable throwable);&#125; è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»æŠŠæ•°æ®è¯·æ±‚çš„æŽ¥å£ï¼Œä»¥åŠæ•°æ®è¿”å›žçš„æŽ¥å£éƒ½å®šä¹‰å¥½äº†ï¼Œæ•´ç†ä¸€ä¸‹æ€ç»ª é¦–å…ˆæˆ‘ä»¬æžæ¸…æ¥šhttpè¯·æ±‚ï¼Œæœ‰å“ªäº›æ–¹æ³•ï¼Œéœ€è¦æœ‰å“ªäº›å‚æ•°â€”â€”IRequestManagerï¼› æ•°æ®è¿”å›žä¼šæœ‰ä»€ä¹ˆæƒ…å†µï¼Ÿâ€”â€”IRequestCallbackï¼› Step2:ç”¨Volleyæ¥å®žçŽ°IRequestManagerè¿™ä¸ªæŽ¥å£.12345678910111213141516171819202122232425262728293031323334353637383940public class VolleyRequestManager implements IRequestManager &#123; ... @Override public void get(String url, final IRequestCallback requestCallback) &#123; StringRequest request = new StringRequest(Request.Method.GET, url, new Response.Listener&lt;String&gt;() &#123; @Override public void onResponse(String s) &#123; requestCallback.onSuccess(s); &#125; &#125;, new Response.ErrorListener() &#123; @Override public void onErrorResponse(VolleyError volleyError) &#123; requestCallback.onFailure(volleyError); &#125; &#125;); HttpRequestExampleApp.mQueue.add(request); &#125; @Override public void post(String url, String requestBodyJson, final IRequestCallback requestCallback) &#123; requestWithBody(url, requestBodyJson, requestCallback, Request.Method.POST); &#125; @Override public void put(String url, String requestBodyJson, final IRequestCallback requestCallback) &#123; requestWithBody(url, requestBodyJson, requestCallback, Request.Method.PUT); &#125; @Override public void delete(String url, String requestBodyJson, final IRequestCallback requestCallback) &#123; requestWithBody(url, requestBodyJson, requestCallback, Request.Method.DELETE); &#125; ...&#125; VolleyRequestManagerå®žçŽ°äº†IRequestManageræŽ¥å£ï¼Œåˆ°è¿™é‡Œæˆ‘æƒ³ä½ ä¹Ÿçœ‹å‡ºæ¥å¯ä»¥ä½¿ç”¨VolleyRequestManageræ¥è¿›è¡Œget/post/put/deleteæ“ä½œäº†ï¼Œæ˜¯çš„ï¼Œå·²ç»å¯ä»¥ç”¨äºŽè¯·æ±‚æ“ä½œï¼Œä½†æ˜¯æˆ‘ä»¬å…ˆä¸è¿™æ ·åšï¼ŒåŽŸå› è¯·ç»§ç»­å¾€ä¸‹çœ‹Step3ã€‚ Step3ï¼šåˆ›å»ºä¸€ä¸ªç±»æ¥è¿”å›žIRequestManagerè¯·æ±‚æŽ¥å£çš„å¯¹è±¡1234567891011121314/* * è¯¥ç±»çš„ä½œç”¨æ˜¯ç”¨äºŽè¿”å›žä¸€ä¸ªIRequestManagerå¯¹è±¡ï¼Œè¿™ä¸ªIRequestManagerçš„å®žçŽ°ç±» * å¯ä»¥æ˜¯ä½¿ç”¨Volleyå®žçŽ°çš„httpè¯·æ±‚å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥æ˜¯OkHttpå®žçŽ°çš„httpè¯·æ±‚å¯¹è±¡ * Activity/Fragment/Presenterä¸­ï¼Œåªè¦è°ƒç”¨getRequestManager()æ–¹æ³•å°±èƒ½å¾—åˆ° * httpè¯·æ±‚çš„æ“ä½œæŽ¥å£ï¼Œè€Œä¸ç”¨å…³å¿ƒå…·ä½“æ˜¯ä½¿ç”¨ä»€ä¹ˆå®žçŽ°çš„ã€‚ */public class RequestFactory &#123; public static IRequestManager getRequestManager()&#123; return VolleyRequestManager.getInstance(); //return OkHttpRequestManager.getInstance(); &#125; &#125; åˆ°è¿™é‡Œï¼Œè¯·å®¹è®¸æˆ‘å†é€¼é€¼ä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆè¦ç”¨è¿™ç§æ–¹æ³•æ¥è¿”å›žå¯¹è±¡ï¼Œè€Œä¸ç›´æŽ¥åœ¨Activity/Fragment/Presenterä¸­åˆ›å»ºVolleyRequestManagerå¯¹è±¡æ¥è¿›è¡Œæ“ä½œï¼Ÿå¦‚æžœç›´æŽ¥åœ¨Activity/Fragment/Presenterä¸­ä½¿ç”¨VolleyRequestManageræ¥åˆ›å»ºå¯¹è±¡ï¼Œä½ çš„ä»£ç å°±ä¾èµ–äº†VolleyRequestManagerï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æžœè¦æ›´æ¢æˆOkHttpï¼Œå²‚ä¸æ˜¯è¦æŠŠä»£ç ä¸­æ‰€æœ‰çš„VolleyRequestManagerå¯¹è±¡ä¹Ÿæ›´æ¢æˆOkHttpçš„è¯·æ±‚å¯¹è±¡ï¼Ÿå†è¯•æƒ³ä¸€ä¸‹ï¼Œå¦‚æžœä½ æœ‰å¾ˆå¤šä¸ªActivity/Fragment/Presenterä½¿ç”¨äº†VolleyRequestManagerå¯¹è±¡ï¼Œä½ æ˜¯ä¸æ˜¯è¦æ¯ä¸ªåœ°æ–¹éƒ½æ›´æ¢ä¸€éï¼Ÿ ä½¿ç”¨RequestFactoryçš„æ–¹å¼åœ¨Activity/Fragment/Presenterä¸­åˆ›å»ºå¯¹è±¡ï¼Œä»£ç åªä¾èµ–äº†IRequestManagerè¿™ä¸ªæŽ¥å£ï¼Œè¿™å°±æ˜¯ä½¿ç”¨æŽ¥å£è¿›è¡Œè§£è€¦çš„å…³é”®ç‚¹ï¼Œæ— è®ºåœ¨ä»€ä¹ˆåœ°æ–¹ä½¿ç”¨äº†è¿™ä¸ªæŽ¥å£ï¼Œå½“è¦æ›´æ¢å®žçŽ°çš„æ—¶å€™ï¼Œåªéœ€è¦ä¿®æ”¹RequestFactoryä¸­returnçš„å®žçŽ°ç±»å°±å¯ä»¥äº†ã€‚ Step4:è°ƒç”¨ä¸Šè¿°æ–¹æ³•è¿›è¡Œæµ‹è¯•1234567891011121314151617181920212223242526272829public class MainActivity extends AppCompatActivity &#123; private static final String TAG = "MainActivity"; @Override protected void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); setContentView(R.layout.activity_main); //è¯·æ±‚æµ‹è¯•url String url = "https://api.douban.com/v2/movie/top250"; //è¿™é‡Œå‘èµ·è¯·æ±‚ä¾èµ–çš„æ˜¯IRequestManageræŽ¥å£ï¼Œè€Œæ²¡æœ‰å…·ä½“å®žçŽ°ç±»ä»£ç å‡ºçŽ°åœ¨è¿™é‡Œ IRequestManager requestManager = RequestFactory.getRequestManager(); //è°ƒç”¨æŽ¥å£çš„getæ–¹æ³• requestManager.get(url, new IRequestCallback() &#123; @Override public void onSuccess(String response) &#123; Log.d(TAG, "onSuccess: " + response); //// TODO: 2016/12/11 your code &#125; @Override public void onFailure(Throwable throwable) &#123; throwable.printStackTrace(); //// TODO: 2016/12/11 your code &#125; &#125;); &#125;&#125; æ³¨æ„æˆ‘ä»¬åˆ›å»ºè¯·æ±‚å¯¹è±¡çš„ä»£ç ï¼Œè¿™é‡Œæ²¡æœ‰å‡ºçŽ°å…·ä½“çš„å®žçŽ°ç±»ï¼šIRequestManager requestManager = RequestFactory.getRequestManager(); Step5:ä¸æ›´æ”¹MainActivityä¸­ä»»ä½•ä»£ç ï¼ŒæŠŠHttpè¯·æ±‚çš„é€»è¾‘æ›¿æ¢æˆOkHttpæ¥å®žçŽ°1ï¼‰å…ˆç”¨OkHttpæ¥å®žçŽ°IRequestManagerè¿™ä¸ªæŽ¥å£. 123456789101112131415161718192021222324252627282930313233343536public class OkHttpRequestManager implements IRequestManager &#123; ... @Override public void get(String url, IRequestCallback requestCallback) &#123; Request request = new Request.Builder() .url(url) .get() .build(); addCallBack(requestCallback, request); &#125; @Override public void post(String url, String requestBodyJson, IRequestCallback requestCallback) &#123; RequestBody body = RequestBody.create(TYPE_JSON, requestBodyJson); Request request = new Request.Builder() .url(url) .post(body) .build(); addCallBack(requestCallback, request); &#125; @Override public void put(String url, String requestBodyJson, IRequestCallback requestCallback) &#123; ... &#125; @Override public void delete(String url, String requestBodyJson, IRequestCallback requestCallback) &#123; ... &#125; ... &#125; 2) ä½¿ç”¨OkHttpæ›´æ¢VolleyçŽ°åœ¨æˆ‘ä»¬ç”¨OkHttpçš„è¯·æ±‚æ–¹å¼ä¹Ÿå®žçŽ°äº†ä¸€å¥—get/post/put/deleteçš„è¯·æ±‚æ–¹æ³•ï¼Œæ­¤æ—¶åªè¦ä¿®æ”¹Step3ä¸­ï¼Œè¿”å›žçš„å¯¹è±¡ä¸ºOkHttpRequestManagerå¯¹è±¡ï¼Œå°±å·²ç»å®Œæˆäº†æˆ‘ä»¬æ•´ä¸ªhttpè¯·æ±‚æ¡†æž¶çš„æ›´æ¢ï¼Œæ­¤æ—¶ï¼Œä½ å¯ä»¥å®Œå…¨ç§»é™¤Volleyçš„å¼•ç”¨ä»¥åŠä»£ç ï¼Œè€Œä¸ä¼šå¯¹ç¨‹åºæœ‰ä»»ä½•å½±å“ã€‚ æ€»ç»“ï¼šå¯¹äºŽæœ‰å¤šç§å¯æ›¿ä»£è§£å†³æ–¹æ¡ˆçš„ä¸šåŠ¡é€»è¾‘ï¼Œæˆ‘çš„è§£è€¦æ€è·¯æ˜¯è¿™æ ·çš„ï¼š æŠ½å–å®ƒä»¬çš„å…±æ€§æ–¹æ³•åˆ°æŽ¥å£ä¸­ï¼› ä½¿ç”¨è‡ªå·±é€‰æ‹©çš„å®žçŽ°æ–¹æ¡ˆåŽ»å®žçŽ°ï¼› ä½¿ç”¨â€œå·¥åŽ‚â€ç±»æŠŠå…·ä½“å®žçŽ°è½¬æ¢æˆæŠ½è±¡æŽ¥å£ï¼Œå¹¶è¿”å›žæŠ½è±¡æŽ¥å£å¯¹è±¡ï¼› Activity/Fragment/Presenterä¸­ï¼Œä½¿ç”¨â€œå·¥åŽ‚â€ä¸­è¿”å›žçš„æŽ¥å£è¿›è¡Œæ“ä½œï¼Œè€Œä¸è¦ä¾èµ–äºŽå…¶å®žçŽ°ç±»ã€‚ è¦æ›´æ¢æ–¹æ¡ˆçš„æ—¶å€™ï¼Œåªéœ€è¦ä¿®æ”¹â€œå·¥åŽ‚â€ä¸­è¿”å›žçš„å®žçŽ°ç±»ã€‚ åŽè®°è¿™ç¯‡æ–‡ç« åªæ˜¯æä¾›ä¸€ç§è§£è€¦æ€æƒ³ï¼Œè€Œä¸æ˜¯â€œå¦‚ä½•å°è£…httpè¯·æ±‚æ¡†æž¶â€çš„æ•™ç¨‹ï¼Œä¹Ÿä¸æ˜¯è®¨è®ºâ€œå“ªä¸ªhttpè¯·æ±‚æ¡†æž¶å¥½ç”¨â€çš„æ–‡ç« ï¼Œå½“ç„¶ï¼Œä½ å®Œå…¨å¯ä»¥ç”¨è¿™ç§æ–¹æ³•è¿›è¡Œhttpè¯·æ±‚çš„å°è£…ã€‚ç„¶åŽï¼Œè¿™ç¯‡æ–‡ç« æ˜¯åšä¸»çš„ç¬¬ä¸€ç¯‡æ–‡ç« ï¼Œå¯èƒ½å†™å¾—ä¸æ˜¯å¾ˆå¥½ï¼Œæ¬¢è¿Žå¤§å®¶æå‡ºå®è´µæ„è§ã€‚]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
        <tag>å¥‡æŠ€æ·«å·§</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ¬¢è¿Žé˜…è¯»]]></title>
    <url>%2F2016%2F06%2F19%2FWelcome%2F</url>
    <content type="text"><![CDATA[æ¬¢è¿Žé˜…è¯»ä½ å¥½ï¼Œæˆ‘æ˜¯ä¸€ä½Androidå¼€å‘å·¥ç¨‹å¸ˆï¼Œä¸‰å¹´å·¥ä½œç»éªŒã€‚æˆ‘çš„åšå®¢æœ€ä¸»è¦çš„ç”¨é€”æ˜¯ç”¨äºŽåˆ†äº«æˆ‘ä¸ªäººå¯¹æŠ€æœ¯çš„è§‚ç‚¹ä»¥åŠç»éªŒï¼Œæˆ‘å¸Œæœ›è¿™äº›å†…å®¹å¯ä»¥å¸®åŠ©åˆ°æœ‰éœ€è¦çš„äººï¼ŒåŒæ—¶ï¼Œä¹Ÿå¸Œæœ›é€šè¿‡å†™ä½œï¼Œæ¥æé«˜è‡ªå·±å¯¹æŠ€æœ¯çš„ç†è§£ã€‚ä¸€èµ·åŠ æ²¹ï¼ï¼]]></content>
  </entry>
</search>
